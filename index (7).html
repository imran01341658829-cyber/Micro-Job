<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Earning Zone - Premium Microjob &amp; Freelancing Platform</title>

    <!-- Favicon Code Start -->
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <!-- Favicon Code End -->

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&amp;display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js" defer=""></script>
    <style>
        :root {
            --primary-color-landing: #4f46e5; --primary-hover: #4338ca; --dark-blue: #111827; --secondary-blue: #1f2937; --text-light: #9ca3af; --text-normal: #6b7280; --white-color: #fff; --light-bg: #f9fafb; --border-color: #e5e7eb;
            --primary-color: #6a11cb; --primary-gradient: linear-gradient(135deg, #2575fc, #6a11cb); --dark-color: #1a1a2e; --light-color: #f0f2f5; --grey-color: #929aab; --error-color: #e74c3c; --success-color: #2ecc71; --pending-color: #f39c12; --info-color: #3498db;
        }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        html { scroll-behavior: smooth; }
        body { font-family: 'Poppins', sans-serif; color: var(--dark-blue); line-height: 1.7; background: var(--white-color); overflow-x: hidden; }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 1rem; }
        a { text-decoration: none; color: inherit; }
        
        body.no-scroll { overflow: hidden; }

        .main-header { position: fixed; top: 0; left: 0; right: 0; z-index: 1000; background: rgba(255, 255, 255, 0.85); backdrop-filter: saturate(180%) blur(10px); border-bottom: 1px solid var(--border-color); }
        .header-content { display: flex; justify-content: space-between; align-items: center; height: 70px; }
        
        .main-nav { display: flex; align-items: center; gap: 1rem; }
        .main-nav .btn-secondary { background: transparent; color: var(--dark-blue); border: 1px solid var(--border-color); }
        .main-nav .btn-secondary:hover { background: var(--light-bg); }

        .mobile-menu-toggle { display: none; background: none; border: none; cursor: pointer; z-index: 1010; padding: 0; }
        .mobile-menu-toggle svg { width: 28px; height: 28px; color: var(--dark-blue); }

        .header-center-title {
            display: none; font-size: 1.25rem; font-weight: 700; color: var(--dark-blue);
            position: absolute; left: 50%; transform: translateX(-50%); white-space: nowrap;
        }
        .header-right-nav { display: flex; align-items: center; }

        .mobile-nav-container { 
            display: flex; flex-direction: column; position: fixed; top: 0; right: -100%; width: 80%; max-width: 320px; height: 100vh; background: var(--white-color); 
            padding: 6rem 2rem 2rem 2rem; box-shadow: -10px 0 30px rgba(0,0,0,0.1); transition: transform 0.35s ease-in-out; z-index: 1001; 
        }

        .mobile-nav-container.is-open { transform: translateX(-100%); }
        
        .mobile-nav-buttons { margin-top: 1.5rem; width: 100%; display: flex; flex-direction: column; gap: 1rem; }
        .mobile-nav-container .btn { width: 100%; text-align: center; padding: 0.9rem; font-size: 1rem; }
        .mobile-menu-close-btn { position: absolute; top: 1.5rem; right: 1.5rem; background: none; border: none; cursor: pointer; }
        .mobile-menu-close-btn svg { width: 32px; height: 32px; color: var(--dark-blue); }

        @media (max-width: 768px) {
            .main-nav { display: none; } .mobile-menu-toggle { display: block; } .header-center-title { display: block; } .logo span { display: none; }
        }
        
        .logo { font-size: 1.5rem; font-weight: 800; display: flex; align-items: center; color: var(--dark-blue); }
        .logo svg { width: 32px; height: 32px; margin-right: 10px; color: var(--primary-color-landing); }
        .btn { padding: 0.65rem 1.5rem; border-radius: 50px; font-weight: 600; transition: all 0.3s ease; display: inline-block; border: none; cursor: pointer; font-size: 0.9rem; }
        .btn-primary { background: var(--primary-color-landing); color: var(--white-color); box-shadow: 0 4px 14px rgba(79, 70, 229, 0.3); }
        .btn-primary:hover { background: var(--primary-hover); transform: translateY(-2px); box-shadow: 0 7px 18px rgba(79, 70, 229, 0.4); }
        #landing-page-view .hero { background: var(--light-bg); padding: 160px 0 100px 0; text-align: center; }
        .hero-content h1 { font-size: clamp(2.5rem, 5.5vw, 4.5rem); font-weight: 800; line-height: 1.2; margin-bottom: 1.5rem; color: var(--dark-blue); }
        .hero-content .highlight { color: var(--primary-color-landing); }
        .hero-content p { font-size: 1.1rem; color: var(--text-normal); max-width: 650px; margin: 0 auto 2rem auto; }
        .hero-content .btn { font-size: 1rem; padding: 1rem 2.5rem; }
        .section { padding: 4rem 0; } .section-title { text-align: center; margin-bottom: 3.5rem; } .section-title h2 { font-size: 2.2rem; font-weight: 700; margin-bottom: 0.5rem; }
        .section-title p { color: var(--text-normal); font-size: 1rem; } .steps-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 2.5rem; } .step-card { text-align: center; }
        .step-icon { width: 70px; height: 70px; margin: 0 auto 1.5rem auto; border-radius: 50%; background: #eef2ff; color: var(--primary-color-landing); display: flex; align-items: center; justify-content: center; }
        .step-icon svg { width: 36px; height: 36px; } .step-card h3 { font-size: 1.2rem; font-weight: 600; margin-bottom: 0.5rem; } .step-card p { color: var(--text-normal); }
        .stats-section { background: var(--light-bg); } .stats-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 1.5rem; }
        .stat-card { background: var(--white-color); padding: 2rem 1.5rem; border-radius: 12px; border: 1px solid var(--border-color); transition: transform 0.3s ease, box-shadow 0.3s ease; text-align: center; }
        .stat-card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.07); } .stat-card .icon svg { width: 50px; height: 50px; margin: 0 auto 1.2rem auto; color: var(--primary-color-landing); display: block; }
        .stat-card h3 { font-size: 2.2rem; font-weight: 700; line-height: 1; } .stat-card p { font-size: 1rem; font-weight: 500; color: var(--text-normal); margin-top: 0.5rem; }
        #landing-page-view .main-footer { background: var(--dark-blue); color: var(--text-light); padding: 5rem 0 2rem 0; } .footer-grid { display: grid; grid-template-columns: 2fr 1fr 1fr 1.5fr; gap: 2.5rem; margin-bottom: 4rem; }
        .footer-col h4 { color: var(--white-color); margin-bottom: 1.5rem; font-size: 1.1rem; } .footer-col ul { list-style: none; } .footer-col li { margin-bottom: 0.8rem; }
        .footer-col a:hover { color: var(--white-color); } .footer-col p { line-height: 1.8; } .footer-logo-col .logo { margin-bottom: 1.5rem; color: var(--white-color); }
        #landing-page-view .social-links a { display: inline-flex; justify-content: center; align-items: center; width: 44px; height: 44px; background: var(--secondary-blue); color: var(--white-color); border-radius: 50%; margin-right: 0.5rem; transition: background-color 0.3s ease; }
        #landing-page-view .social-links a:hover { background-color: var(--primary-color-landing); } #landing-page-view .social-links svg { width: 22px; height: 22px; }
        .footer-bottom { border-top: 1px solid var(--secondary-blue); padding-top: 2rem; text-align: center; font-size: 0.9rem; }
        @media (max-width: 992px) { .footer-grid { grid-template-columns: repeat(2, 1fr); } .stats-grid { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 768px) { .steps-grid, .footer-grid { grid-template-columns: 1fr; } .footer-col { text-align: center; } .footer-logo-col { display: flex; justify-content: center; } .footer-col .social-links { justify-content: center; } }
        @media (max-width: 576px) { .stats-grid { grid-template-columns: 1fr; } }
        #user-panel-view body { font-family: 'Poppins', sans-serif; margin: 0; background-color: var(--light-color); color: var(--dark-color); }
        #user-panel-view header { background: var(--white-color); box-shadow: 0 4px 12px rgba(0,0,0,0.05); position: fixed; left: 0; width: 100%; z-index: 1000; top: 0; padding: 1rem; display: flex; justify-content: space-between; align-items: center; }
        #user-panel-view .user-profile { display: flex; align-items: center; gap: 12px; cursor: pointer; } .profile-icon { width: 45px; height: 45px; border-radius: 50%; object-fit: cover; border: 2px solid var(--primary-color); }
        .user-name { font-weight: 600; font-size: 1.1rem; } .user-balance-header { background: var(--primary-gradient); color: var(--white-color); padding: 6px 12px; border-radius: 20px; font-weight: 500; font-size: 0.9rem; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        #user-panel-view main { padding: 6rem 1rem 6rem; } #user-panel-view .bottom-nav { background: var(--white-color); box-shadow: 0 -4px 12px rgba(0,0,0,0.05); position: fixed; left: 0; width: 100%; z-index: 1000; bottom: 0; display: flex; justify-content: space-around; padding: 0.5rem 0; }
        #user-panel-view .nav-item { display: flex; flex-direction: column; align-items: center; color: var(--grey-color); text-decoration: none; transition: all 0.3s; fill: var(--grey-color); flex: 1; text-align: center; }
        #user-panel-view .nav-item.active { color: var(--primary-color); fill: var(--primary-color); transform: translateY(-3px); } .nav-item svg { width: 26px; height: 26px; } .nav-item span { font-size: 0.75rem; margin-top: 4px; font-weight: 500; }
        .auth-container { display: flex; flex-direction:column; justify-content: center; align-items: center; min-height: 100vh; padding: 1rem; background: var(--primary-gradient); }
        .auth-box { width: 100%; max-width: 400px; padding: 2.5rem; background: var(--white-color); box-shadow: 0 8px 30px rgba(0,0,0,0.1); border-radius: 16px; text-align: center; }
        input, select, textarea { width: 100%; padding: 1rem; margin-bottom: 1rem; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        input:disabled, select:disabled, textarea:disabled { background-color: #f0f2f5; cursor: not-allowed; opacity: 0.7; }
        button, .button { width: 100%; padding: 1rem; border: none; background: var(--primary-gradient); color: white; font-size: 1rem; border-radius: 8px; cursor: pointer; transition: all 0.3s; text-align: center; text-decoration: none; display: inline-block; font-weight: 600; }
        button:disabled { background: var(--grey-color); cursor: not-allowed; }
        /* --- START: New Styles for Auth page --- */
        .auth-box p a {
            color: var(--primary-color-landing);
            font-weight: 600;
        }
        .auth-box p a:hover {
            text-decoration: underline;
        }
        .password-wrapper {
            position: relative;
            margin-bottom: 1rem;
        }
        .password-wrapper input {
            margin-bottom: 0;
            padding-right: 2.8rem;
        }
        .password-toggle {
            position: absolute;
            top: 50%;
            right: 0.75rem;
            transform: translateY(-50%);
            cursor: pointer;
            color: var(--grey-color);
            background: none;
            border: none;
            padding: 0;
            width: 24px;
            height: 24px;
        }
        .password-toggle svg {
            width: 20px;
            height: 20px;
        }
        /* --- END: New Styles for Auth page --- */
        #user-panel-view .card { background: var(--white-color); padding: 1.5rem; margin-bottom: 1.5rem; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.06); }
        .loader-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(255, 255, 255, 0.8); display: flex; justify-content: center; align-items: center; z-index: 10001; backdrop-filter: blur(4px); }
        .loader { border: 5px solid var(--light-color); border-top: 5px solid var(--primary-color); border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; } @keyframes spin { 100% { transform: rotate(360deg); } }
        .alert-card { padding: 1.5rem; text-align: center; border-radius: 12px; font-weight: 500; } .alert-pending { background-color: #fffbe6; border: 1px solid #ffe58f; color: #d46b08; }
        .alert-inactive { background-color: #fff1f0; border: 1px solid #ffa39e; color: #cf1322; } .alert-success { background-color: #f6ffed; border: 1px solid #b7eb8f; color: #389e0d; }
        .list-item { display: flex; justify-content: space-between; align-items: center; padding: 0.8rem 0; border-bottom: 1px solid #eee; flex-wrap: wrap; gap: 10px; } .item-actions { display: flex; gap: 0.5rem; align-items: center; flex-wrap: wrap; }
        .item-actions .button, .item-actions button { width: auto; font-size: 0.8rem; padding: 0.4rem 0.8rem; margin-top: 5px;}
        .btn-view-proof { background-color: var(--info-color); } .btn-approve { background-color: var(--success-color); } .btn-reject { background-color: var(--error-color); }
        .status-badge { padding: 4px 10px; border-radius: 16px; font-size: 0.8rem; font-weight: 600; text-transform: capitalize; }
        .status-approved { background-color: var(--success-color); color: white; } .status-pending { background-color: var(--pending-color); color: white; } .status-rejected { background-color: var(--error-color); color: white; }
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: none; justify-content: center; align-items: center; z-index: 10000; padding: 1rem; box-sizing: border-box; backdrop-filter: blur(4px);}
        .modal-content { background: white; padding: 1.5rem; border-radius: 12px; width: 100%; max-width: 500px; box-shadow: 0 5px 25px rgba(0,0,0,0.2); max-height: 90vh; overflow-y: auto;}
        .modal-content h3 { margin-top: 0; } .modal-content img { max-width: 100%; border-radius: 8px; margin: 0.5rem 0; } .close-modal-btn { background: var(--grey-color); margin-top: 1rem; }
        .increase-limit-form { margin-top: 1.5rem; border-top: 1px solid #eee; padding-top: 1.5rem; } .increase-limit-form-inner { display: flex; gap: 10px; align-items: center;}
        .increase-limit-form input { margin-bottom: 0; } .increase-limit-form p { font-size: 0.8rem; color: var(--grey-color); margin: 5px 0 0 0; text-align: center; }
        .home-header{background:var(--primary-gradient);color:white;padding:2rem 1.5rem;border-radius:16px;text-align:center;box-shadow:0 8px 25px rgba(0,0,0,0.1);margin-bottom:1.5rem}.home-header h2{margin:0;font-weight:600;font-size:1.5rem}.home-header p{margin:.5rem 0 0 0;opacity:.8;font-size:.9rem}.home-balance{font-size:2.8rem;font-weight:700;margin:1.5rem 0;line-height:1}.home-balance sup{font-size:1.5rem;font-weight:500;margin-right:4px}.home-header .button{background:rgba(255,255,255,0.2);font-size:.9rem;padding:.8rem 1.5rem;width:auto;border-radius:25px;display:inline-block}
        .stat-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:1rem} .stat-item{background:var(--light-color);padding:1rem;border-radius:12px;text-align:center}
        .stat-item .icon{width:40px;height:40px;margin:0 auto .5rem auto;display:flex;align-items:center;justify-content:center;color:var(--primary-color);} .stat-item .icon svg{width:28px;height:28px;fill:currentColor}
        .stat-item h4{margin:0;font-size:1.2rem;font-weight:600;color:var(--dark-color)} .stat-item p{margin:.2rem 0 0 0;font-size:.8rem;color:var(--grey-color)}
        .quick-actions .button{display:flex;align-items:center;justify-content:flex-start;padding:1.2rem 1rem;text-align:left;margin-bottom:1rem;font-size:1rem;background:var(--white-color);color:var(--dark-color);border:1px solid #e0e0e0;box-shadow:0 2px 8px rgba(0,0,0,0.05)}.quick-actions .button svg{width:24px;height:24px;margin-right:12px;fill:var(--primary-color)}
        #user-panel-view .social-links{display:flex;justify-content:center;gap:1.5rem;margin-top:1rem}
        #user-panel-view .social-icon{color:var(--grey-color);text-decoration:none;transition:color .3s} #user-panel-view .social-icon svg{width:28px;height:28px} #user-panel-view .social-icon:hover{color:var(--primary-color)}
        .refer-hero-card{background:var(--primary-gradient);color:var(--white-color);text-align:center;padding:2.5rem 1.5rem;border-radius:16px;margin-bottom:1.5rem;box-shadow:0 8px 25px rgba(0,0,0,0.15)}.refer-hero-card h3{margin:0;font-size:1.8rem}.refer-hero-card p{margin:.5rem 0 1.5rem 0;font-size:1rem;opacity:.9}.refer-bonus-display{font-size:3.5rem;font-weight:700;margin:1rem 0;line-height:1}.refer-bonus-display sup{font-size:1.8rem;font-weight:500;top:-1.2rem;position:relative;}.refer-code-box{background:rgba(255,255,255,.1);border:1px dashed rgba(255,255,255,.5);padding:1rem;border-radius:12px;margin-top:1.5rem}.refer-code-box span{font-size:1.5rem;font-weight:600;letter-spacing:2px}
        .refer-stat-card{ text-align: center; }.refer-stat-card .icon{ background:var(--primary-gradient);color:white;width:60px;height:60px;border-radius:50%;display:inline-flex;justify-content:center;align-items:center;margin-bottom:1rem; }.refer-stat-card .icon svg{width:30px;height:30px;fill:white;} .refer-stat-card h4{font-size:1.1rem;margin:0 0 .5rem 0} .refer-stat-card p{font-size:1.5rem;font-weight:600;color:var(--dark-color);margin:0;}
        .tab-buttons { display: flex; gap: 1rem; margin-bottom: 1.5rem; }
        .tab-buttons .button { background-color: var(--white-color); color: var(--dark-color); border: 1px solid #ddd; flex: 1; padding: 0.8rem; font-size: 0.9rem;}
        .tab-buttons .button.active { background: var(--primary-gradient); color: white; }
        
        .progress-bar { width: 100%; background-color: var(--light-color); border-radius: 5px; overflow: hidden; height: 8px; margin: 0.8rem 0; }
        .progress-bar-inner { height: 100%; background: var(--primary-gradient); width: 0%; transition: width 0.3s; }
        
        .activation-card .payment-info { font-weight: 600; font-size: 1.1rem; padding: 1rem; border-radius: 8px; background: #eee; display: flex; align-items: center; justify-content: space-between;}
        .activation-card .copy-btn { padding: 0.4rem 0.8rem; font-size: 0.8rem; width: auto; background-color: var(--grey-color); color: white; cursor: pointer; border-radius: 6px; border:none; }
        .logout-button { background-color: var(--error-color); margin-top: 1.5rem; }
        #image-crop-container { max-height: 40vh; margin-top: 1rem; }
        #image-crop-container img { max-width: 100%; }
        .referral-status-list h4 { margin-bottom: 1rem; text-align: center; }
        .referral-list-item { display: flex; justify-content: space-between; align-items: center; padding: 0.8rem; border-radius: 8px; background-color: var(--light-bg); margin-bottom: 0.5rem; }
        .referral-list-item .name { font-weight: 600; }
        .referral-list-item .status { font-size: 0.9rem; color: var(--grey-color); }
        .referral-list-item .status.complete { color: var(--success-color); font-weight: 600; }
        
        .job-card-item {
            background: var(--white-color); padding: 1rem; margin-bottom: 1rem; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.06);
            display: flex; gap: 1rem; align-items: center; cursor: pointer; transition: transform 0.2s, box-shadow 0.2s;
        }
        .job-card-item:hover { transform: translateY(-3px); box-shadow: 0 6px 20px rgba(0,0,0,0.08); }
        .job-card-thumb { width: 60px; height: 60px; border-radius: 8px; object-fit: cover; background-color: var(--light-color); flex-shrink: 0; }
        .job-card-details { flex-grow: 1; }
        .job-card-title { font-weight: 600; margin-bottom: 0.5rem; }
        .job-card-footer { display: flex; justify-content: space-between; align-items: center; font-size: 0.9rem; }
        .job-card-progress-text { color: var(--grey-color); }
        .job-card-reward { font-weight: 700; font-size: 1rem; color: var(--primary-color); }
        
        .task-details-header { margin-bottom: 1.5rem; }
        .task-details-header img { max-width: 100%; border-radius: 12px; margin-bottom: 1rem; }
        .task-details-header h3 { font-size: 1.5rem; }
        .task-details-body h4 { margin-top: 1.5rem; margin-bottom: 0.5rem; border-bottom: 2px solid var(--primary-color); padding-bottom: 0.5rem; display: inline-block; }
        .task-details-body p { white-space: pre-wrap; line-height: 1.8; }
        
        .back-button {
            display: inline-flex; align-items: center; gap: 8px; margin-bottom: 1rem;
            background: none; color: var(--dark-color); padding: 0; width: auto; font-size: 1rem; font-weight: 600;
        }
        .back-button svg { width: 24px; height: 24px; }
        
        .step-indicators { display: flex; justify-content: space-between; margin-bottom: 2rem; }
        .step-indicator { width: 40px; height: 40px; border-radius: 50%; background-color: var(--light-color); color: var(--grey-color);
            display: flex; align-items: center; justify-content: center; font-weight: 600; border: 2px solid var(--border-color); position: relative; }
        .step-indicator.active { background: var(--primary-color); color: white; border-color: var(--primary-color); }
        .step-indicator:not(:last-child)::after {
            content: ''; position: absolute; left: 100%; top: 50%; transform: translateY(-50%); width: 100%; height: 2px;
            background-color: var(--border-color); z-index: -1;
        }
        .add-task-step { display: none; }
        .add-task-step.active { display: block; }
        .step-navigation { display: flex; gap: 1rem; margin-top: 1rem; }
        .step-navigation .button { flex: 1; }
        #add-task-thumbnail-preview { max-width: 150px; border-radius: 8px; margin-top: 1rem; display: none; }
    </style>
</head>
<body>
    <div id="loader" class="loader-overlay" style="display: none;"><div class="loader"></div></div>

    <div id="landing-page-view" style="display: block;">
        <header class="main-header"> <div class="container"> <div class="header-content"> <a href="#" class="logo"> <svg viewBox="0 0 100 100"><path fill="currentColor" d="M85,39.31a8.45,8.45,0,0,0-4.22-3.69L51.9,20.08a8.45,8.45,0,0,0-8.45,0L14.24,35.62a8.45,8.45,0,0,0-4.22,7.38V60.69a8.45,8.45,0,0,0,4.22,7.38L42.1,83.42a8.48,8.48,0,0,0,4.23,1.31,8.39,8.39,0,0,0,4.22-1.31L80.78,68.07a8.45,8.45,0,0,0,4.22-7.38Z" opacity="0.1"></path><path fill="currentColor" d="M60.42,48.2,50,54.14,39.58,48.2,50,42.26Z" opacity="0.3"></path><path fill="currentColor" d="M50,18.75,13.62,37a8.46,8.46,0,0,0,0,15.15l.59.34,25.37,14.65,10-5.73V46.61l-10-5.74V35.13l10-5.74,21.84,12.61,10,5.74.58-.33a8.45,8.45,0,0,0,0-15.15Z"></path></svg> <span>Earning Zone</span> </a> <div class="header-center-title">Earning Zone</div><div class="header-right-nav"> <nav class="main-nav"> <a href="#" id="show-login-header" class="btn btn-secondary">Login</a> <a href="#" id="show-register-header" class="btn btn-primary">Register</a> </nav> <button class="mobile-menu-toggle" id="mobile-menu-btn" aria-label="menu"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"></path></svg> </button> </div></div></div></header>
        <nav class="mobile-nav-container" id="mobile-nav"> <button class="mobile-menu-close-btn" id="mobile-menu-close-btn-inner" aria-label="close menu"> <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"></path></svg> </button> <div class="mobile-nav-buttons"> <a href="#" id="show-login-mobile" class="btn btn-secondary">Login</a> <a href="#" id="show-register-mobile" class="btn btn-primary">Register</a> </div></nav>
        <main> <section class="hero"> <div class="container hero-content"> <h1>Best <span class="highlight">Microjob &amp; Freelancing</span> Site To Make Money Online</h1> <p>Small Gigs. Big Results. Join thousands of freelancers and employers on the most trusted platform.</p> <a href="#" id="start-earning-btn" class="btn btn-primary">Start Earning Now →</a> </div></section> <section class="section how-it-works"> <div class="container"> <div class="section-title"> <h2>How It Works</h2><p>Get started in three simple steps.</p> </div><div class="steps-grid"> <div class="step-card"><div class="step-icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M18 7.5v3m0 0v3m0-3h3m-3 0h-3m-2.25-4.125a3.375 3.375 0 1 1-6.75 0 3.375 3.375 0 0 1 6.75 0ZM3 19.5a2.25 2.25 0 0 1 2.25-2.25h13.5A2.25 2.25 0 0 1 21 19.5"></path></svg></div><h3>1. Create Account</h3><p>Sign up for free in just a few minutes.</p></div><div class="step-card"><div class="step-icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m21 21-5.197-5.197m0 0A7.5 7.5 0 1 0 5.196 5.196a7.5 7.5 0 0 0 10.607 10.607Z"></path></svg></div><h3>2. Find a Job</h3><p>Browse through hundreds of available microjobs.</p></div><div class="step-card"><div class="step-icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5"></path></svg></div><h3>3. Get Paid</h3><p>Complete the task and earn money instantly.</p></div></div></div></section> <section id="stats" class="section stats-section"> <div class="container"> <div class="stats-grid"> <div class="stat-card"><div class="icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6.042A8.967 8.967 0 0 0 6 3.75c-1.052 0-2.062.18-3 .512v14.25A8.987 8.987 0 0 1 6 18c2.305 0 4.408.867 6 2.292m0-14.25a8.966 8.966 0 0 1 6-2.292c1.052 0 2.062.18 3 .512v14.25A8.987 8.987 0 0 0 18 18a8.967 8.967 0 0 0-6 2.292m0-14.25v14.25"></path></svg></div><h3><span id="stats-jobs">3500</span></h3><p>Jobs Posted</p></div><div class="stat-card"><div class="icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M18 18.72a9.094 9.094 0 0 0 3.741-.479 3 3 0 0 0-4.682-2.72m-7.283-2.72c.26A3 3 0 0 1 7.5 15.25a3 3 0 0 1 3-3a3 3 0 0 1 3 3v-1.5a4.5 4.5 0 1 0-9 0v1.5a3 3 0 0 1 3-3-3 3 0 0 1-1.428.828A4.5 4.5 0 0 0 12 10.5v1.5a3 3 0 0 1-3 3Z"></path></svg></div><h3><span id="stats-users">3500</span></h3><p>Total Users</p></div><div class="stat-card"><div class="icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75M21 12a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"></path></svg></div><h3><span id="stats-tasks">2000</span></h3><p>Tasks Done</p></div><div class="stat-card"><div class="icon"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 18.75a60.07 60.07 0 0 1 15.797 2.101c.727.198 1.453-.342 1.453-1.096V18.75M3.75 4.5v.75A.75.75 0 0 1 3 6h-.75m0 0v-.375c0-.621.504-1.125 1.125-1.125H20.25M2.25 6v9m18-10.5v.75c0 .414.336.75.75.75h.75m-1.5-1.5h.375c.621 0 1.125.504 1.125 1.125v9.75c0 .621-.504 1.125-1.125 1.125h-.375m1.5-1.5H21a.75.75 0 0 0-.75.75v.75m0 0H3.75m0 0h-.375a1.125 1.125 0 0 1-1.125-1.125V15m1.5 1.5v-.75A.75.75 0 0 0 3 15h-.75M15 10.5a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z"></path></svg></div><h3>৳<span id="stats-paid">9000</span></h3><p>Paid</p></div></div></div></section> </main>
        <footer class="main-footer"> <div class="container"> <div class="footer-grid"> <div class="footer-col footer-logo-col"><a href="#" class="logo"><svg viewBox="0 0 100 100"><path fill="currentColor" d="M85,39.31a8.45,8.45,0,0,0-4.22-3.69L51.9,20.08a8.45,8.45,0,0,0-8.45,0L14.24,35.62a8.45,8.45,0,0,0-4.22,7.38V60.69a8.45,8.45,0,0,0,4.22,7.38L42.1,83.42a8.48,8.48,0,0,0,4.23,1.31,8.39,8.39,0,0,0,4.22-1.31L80.78,68.07a8.45,8.45,0,0,0,4.22-7.38Z" opacity="1"></path><path fill="#111827" d="M60.42,48.2,50,54.14,39.58,48.2,50,42.26Z" opacity="0.7"></path><path fill="#f9fafb" d="M50,18.75,13.62,37a8.46,8.46,0,0,0,0,15.15l.59.34,25.37,14.65,10-5.73V46.61l-10-5.74V35.13l10-5.74,21.84,12.61,10,5.74.58-.33a8.45,8.45,0,0,0,0-15.15Z" opacity="0.6"></path></svg><span>EARNING ZONE</span></a></div><div class="footer-col"><h4>Company</h4><ul><li><a href="#">About Us</a></li><li><a href="#">Privacy Policy</a></li><li><a href="#">Terms &amp; Conditions</a></li></ul></div><div class="footer-col"><h4>Support</h4><ul><li><a href="#">Contact Us</a></li><li><a href="#">FAQ</a></li></ul></div><div class="footer-col"><h4>Follow us on</h4><div class="social-links"><a href="https://www.facebook.com/earningzonen100" target="_blank" aria-label="Facebook"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.04C6.5 2.04 2 6.53 2 12.06C2 17.06 5.66 21.21 10.44 21.96V14.96H7.9V12.06H10.44V9.85C10.44 7.32 11.93 5.96 14.22 5.96C15.31 5.96 16.45 6.15 16.45 6.15V8.62H15.19C13.95 8.62 13.56 9.39 13.56 10.18V12.06H16.34L15.89 14.96H13.56V21.96C18.34 21.21 22 17.06 22 12.06C22 6.53 17.5 2.04 12 2.04Z"></path></svg></a><a href="https://youtube.com/@earningzone200" target="_blank" aria-label="YouTube"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M10,15L15.19,12L10,9V15M21.56,7.17C21.69,7.64 21.78,8.27 21.84,9.07C21.91,9.87 21.94,10.56 21.94,11.16L22,12C22,12.44 21.97,13.13 21.91,13.93C21.84,14.73 21.75,15.36 21.62,15.83C21.26,17.22 20.12,18.17 18.73,18.53C18.26,18.66 17.63,18.75 16.83,18.81C16.03,18.88 15.34,18.91 14.84,18.91L14,19H10C9.56,19 8.87,18.97 8.07,18.91C7.27,18.84 6.64,18.75 6.17,18.62C4.78,18.26 3.83,17.12 3.47,15.73C3.34,15.26 3.25,14.63 3.19,13.83C3.12,13.03 3.09,12.44 3.09,12L3,11.16C3,10.56 3.03,9.87 3.09,9.07C3.16,8.27 3.25,7.64 3.38,7.17C3.74,5.78 4.88,4.83 6.27,3.47C6.74,3.34 7.37,3.25 8.17,3.19C8.97,3.12 10.66,3.09 11.16,3.09L12,3H13C13.44,3 14.13,3.03 14.93,3.09C15.73,3.16 16.36,3.25 16.83,3.38C18.22,3.74 19.17,4.88 19.53,6.27C19.66,6.74 19.75,7.37 19.81,8.17C19.88,8.97 19.91,9.56 19.91,10.16L20,11V12Z"></path></svg></a><a href="https://t.me/ez_micro_Job" target="_blank" aria-label="Telegram"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.17.91-.494 1.213-.82 1.23-.696.037-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.79-2.318-1.583-.28-3.366.09-.17.91-1.077 1.11-1.302.19-.214.373-.446.13-.646-.24-.2-.536-.08-.82.023-.31.113-2.14.994-2.73 1.486-.59.493-1.115.63-1.55.51-.55-.15-1.29-.35-1.92-.544-1.25-.39-2.19-.19-2.19-.19s-.76.113-.75-1.06c.002-.572.338-.973.885-1.22 3.12-1.42 6.41-2.903 8.12-3.64.44-.187.83-.343 1.22-.343z"></path></svg></a></div></div></div><div class="footer-bottom"><p>© 2025 EARNING ZONE. All Rights Reserved.</p></div></div></footer>
    </div>

    <div id="auth-view" style="display: none;">
        <div class="auth-container">
            <div class="auth-box" id="login-box">
                <h2>Welcome Back!</h2>
                <form id="login-form">
                    <input type="email" id="login-email" placeholder="Email" required="">
                    <div class="password-wrapper">
                        <input type="password" id="login-password" placeholder="Password" required="">
                        <button type="button" class="password-toggle" data-for="login-password"></button>
                    </div>
                    <button type="submit">Login</button>
                    <p style="margin-top:1rem; font-size: 0.9rem;"><a href="#" id="show-forgot-password">পাসওয়ার্ড ভুলে গেছেন?</a></p>
                    <p style="margin-top:1.5rem;">New here? <a href="#" id="show-register">Create an Account</a></p>
                </form>
            </div>
            <div class="auth-box" id="register-box" style="display:none;">
                <h2>Create Account</h2>
                <form id="register-form">
                    <input type="text" id="register-name" placeholder="Full Name" required="">
                    <input type="email" id="register-email" placeholder="Email" required="">
                    <div class="password-wrapper">
                         <input type="password" id="register-password" placeholder="Password (min 6 chars)" required="">
                         <button type="button" class="password-toggle" data-for="register-password"></button>
                    </div>
                    <input type="text" id="register-refer-code" placeholder="Referral Code (Optional)">
                    <button type="submit">Register</button>
                    <p style="margin-top:1.5rem;">Already registered? <a href="#" id="show-login">Login</a></p>
                </form>
            </div>
            <div class="auth-box" id="forgot-password-box" style="display:none;">
                <h2>Reset Password</h2>
                <p style="margin-bottom: 1.5rem;">আপনার রেজিস্টার করা ইমেইলটি দিন, আমরা পাসওয়ার্ড রিসেট করার জন্য একটি লিংক পাঠিয়ে দেব।</p>
                <form id="forgot-password-form">
                    <input type="email" id="forgot-email" placeholder="Email" required="">
                    <button type="submit">রিসেট লিংক পাঠান</button>
                    <p style="margin-top:1.5rem;"><a href="#" id="back-to-login">লগইন পেজে ফিরে যান</a></p>
                </form>
            </div>
            <p id="auth-error-message" style="color:white; font-weight:bold; background: rgba(0,0,0,0.2); padding: 0.5rem; border-radius: 8px; margin-top:1rem; display:none;"></p>
        </div>
    </div>
    
    <div id="user-panel-view" style="display: none;">
        <header><div class="user-profile" id="user-profile-header-btn"><img id="profile-icon" class="profile-icon" alt="profile" loading="lazy"><span id="user-name"></span></div><div class="user-balance-header"><span>Balance: ৳<span id="user-balance-val">0.00</span></span></div></header>
        <main id="app-content"></main>
        <nav class="bottom-nav">
            <a href="#home" class="nav-item active" data-page="home"><svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"></path></svg><span>Home</span></a>
            <a href="#tasks" class="nav-item" data-page="tasks"><svg viewBox="0 0 24 24"><path d="M15.5,13.5C15.5,14.3,14.8,15,14,15H10C9.2,15,8.5,14.3,8.5,13.5V9.5C8.5,8.7,9.2,8,10,8H14C14.8,8,15.5,8.7,15.5,9.5V13.5M12,2C17.5,2,22,6.5,22,12C22,17.5,17.5,22,12,22C6.5,22,2,17.5,2,12C2,6.5,6.5,2,12,2M12,4C7.6,4,4,7.6,4,12C4,16.4,7.6,20,12,20C16.4,20,20,16.4,20,12C20,7.6,16.4,4,12,4Z"></path></svg><span>Tasks</span></a>
            <a href="#add-task" class="nav-item" data-page="add-task"><svg viewBox="0 0 24 24"><path d="M19,13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"></path></svg><span>Add Task</span></a>
            <a href="#my-jobs" class="nav-item" data-page="my-jobs"><svg viewBox="0 0 24 24"><path d="M13.8,7.2L12.4,5.8L11,7.2L12.4,8.6L13.8,7.2M18,11H16V9H18V11M20,6.9L18.6,5.5L17.2,6.9L18.6,8.3L20,6.9M2,2V14H4V22L8,18H16L22,12V2H2M20,11L17,14H8.8L6,16.8V14H4V4H20V11Z"></path></svg><span>My Jobs</span></a>
            <a href="#refer" class="nav-item" data-page="refer"><svg viewBox="0 0 24 24"><path d="M16,13C17.66,13,19,11.66,19,10C19,8.34,17.66,7,16,7C14.34,7,13,8.34,13,10C13,11.66,14.34,13,16,13M8,13C9.66,13,11,11.66,11,10C11,8.34,9.66,7,8,7C6.34,7,5,8.34,5,10C5,11.66,6.34,13,8,13M8,15C5.67,15,1,16.17,1,18.5V21H15V18.5C15,16.17,10.33,15,8,15M16,15C15.71,15,15.38,15.02,15.03,15.05C16.19,15.89,17,17.12,17,18.5V21H23V18.5C23,16.17,18.33,15,16,15Z"></path></svg><span>Refer</span></a>
            <a href="#wallet" class="nav-item" data-page="wallet"><svg viewBox="0 0 24 24"><path d="M20 4H4c-1.11 0-2 .89-2 2v12c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2m0 14H4v-6h16v6m0-10H4V6h16v2z"></path></svg><span>Wallet</span></a>
        </nav>
    </div>

    <div id="proof-modal" class="modal-overlay"><div class="modal-content"><h3>Submitted Proof</h3><div id="proof-modal-body"></div><button id="close-proof-modal" class="button close-modal-btn">Close</button></div></div>
    <div id="profile-modal" class="modal-overlay"><div class="modal-content"><h3>My Profile</h3><div class="quick-actions" style="margin-top: 1rem;"><button id="show-edit-profile-btn" class="button"><svg viewBox="0 0 24 24"><path d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z"></path></svg> Edit Profile</button><a id="live-support-btn" href="#" target="_blank" class="button"><svg viewBox="0 0 24 24"><path d="M12,12.9C10.3,12.9 8.9,11.5 8.9,9.8C8.9,8.1 10.3,6.7 12,6.7C13.7,6.7 15.1,8.1 15.1,9.8C15.1,11.5 13.7,12.9 12,12.9M12,4.9C9.2,4.9 6.9,7.1 6.9,9.8C6.9,12.5 9.2,14.7 12,14.7C14.8,14.7 17.1,12.5 17.1,9.8C17.1,7.1 14.8,4.9 12,4.9M17,16.2C18.4,14.8 19.3,13 19.3,11C19.3,10.9 19.3,10.8 19.3,10.7C19,10.2 18.5,9.8 18.2,9.4C17.8,9.7 17.4,10 16.9,10.2C16.8,11.1 16.2,11.9 15.5,12.4C14.8,12.9 13.9,13.2 13.1,13.2C13.1,13.2 13,13.2 13,13.2C10,13.2 7.6,11.3 6.9,8.5C6.4,8.8 6.1,9.2 5.8,9.4C5.5,9.8 5,10.2 4.7,10.7C4.7,10.8 4.7,10.9 4.7,11C4.7,13 5.6,14.8 7,16.2C7,16.2 7,16.2 7,16.2C5.2,17.1 2.2,17.8 2.2,19.8L2.2,21.6L21.8,21.6L21.8,19.8C21.8,17.8 18.8,17.1 17,16.2M19.8,19.8L4.2,19.8V19.8C4.2,18.8 6.1,18.4 9.4,17.7C10.7,17.3 11.4,16.7 12,16.7C12.6,16.7 13.3,17.3 14.6,17.7C17.9,18.4 19.8,18.8 19.8,19.8Z"></path></svg> Live Support</a><button id="main-logout-btn" class="button logout-button">Logout</button></div><button id="close-profile-modal" class="button close-modal-btn">Close</button></div></div>
    <div id="edit-profile-modal" class="modal-overlay"><div class="modal-content"><h3>Edit Profile</h3><form id="edit-profile-form"><label>Profile Picture:</label><input type="file" id="edit-profile-pic-input" accept="image/*" style="padding: 10px; border: 1px solid #ddd;"><div id="image-crop-container" style="display:none;"><img id="image-to-crop" loading="lazy"></div><label style="margin-top:1rem;">Full Name:</label><input type="text" id="edit-profile-name" required=""><div style="display:flex; gap:10px; margin-top:1rem;"><button type="button" id="cancel-edit-profile" class="button" style="background:var(--grey-color);">Cancel</button><button type="submit" class="button">Save Changes</button></div></form></div></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, onAuthStateChanged, signOut, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";
        import { getDatabase, ref, set, onValue, get, update, serverTimestamp, query, orderByChild, equalTo, push, runTransaction, limitToLast, startAt } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-database.js";
        
        const firebaseConfig = { apiKey: "AIzaSyASQvxR2WyiLpL__H3TYVeFEMew736DHzU", authDomain: "earning-zone-49d20.firebaseapp.com", databaseURL: "https://earning-zone-49d20-default-rtdb.firebaseio.com", projectId: "earning-zone-49d20", storageBucket: "earning-zone-49d20.appspot.com", messagingSenderId: "458693970599", appId: "1:458693970599:web:ce2a044adacf7e34f6e982" };
        const ADMIN_UID = "mFGKEryYOLSSajIFqR3qWqlxwi02";
        const IMAGE_HOSTING_API_KEY = "b84df3bc07b5c2d918e07779431eabf1";
        
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const database = getDatabase(app);
        
        let currentUserId = null, userDataUnsubscribe, activeUserData = {}, appSettings = {}, cropper;

        const loader = document.getElementById('loader'), landingPageView = document.getElementById('landing-page-view'), authView = document.getElementById('auth-view'), userPanelView = document.getElementById('user-panel-view');
        
        const showLoader = (show) => { loader.style.display = show ? 'flex' : 'none'; };
        window.copyToClipboard = (text) => navigator.clipboard.writeText(text).then(() => alert('Copied!'));

        onAuthStateChanged(auth, user => {
            if (userDataUnsubscribe) userDataUnsubscribe();
            if (user && user.uid !== ADMIN_UID) {
                currentUserId = user.uid;
                landingPageView.style.display = 'none'; authView.style.display = 'none'; userPanelView.style.display = 'block';
                initializeUserPanel();
            } else {
                if (user && user.uid === ADMIN_UID) signOut(auth);
                currentUserId = null;
                userPanelView.style.display = 'none'; authView.style.display = 'none'; landingPageView.style.display = 'block';
                initializeLandingPage();
            }
        });
        
        function initializeLandingPage() {
            showLoader(false);
            const mobileMenuBtn = document.getElementById('mobile-menu-btn');
            const mobileNav = document.getElementById('mobile-nav');
            const innerCloseBtn = document.getElementById('mobile-menu-close-btn-inner');

            const toggleMobileMenu = () => {
                mobileNav.classList.toggle('is-open');
                document.body.classList.toggle('no-scroll');
            };

            mobileMenuBtn.addEventListener('click', toggleMobileMenu);
            innerCloseBtn.addEventListener('click', toggleMobileMenu);

            const showAuthView = (showRegister = false) => {
                landingPageView.style.display = 'none';
                authView.style.display = 'block';
                document.getElementById('login-box').style.display = showRegister ? 'none' : 'block';
                document.getElementById('register-box').style.display = showRegister ? 'block' : 'none';
                document.getElementById('forgot-password-box').style.display = 'none';
                if (mobileNav.classList.contains('is-open')) {
                    toggleMobileMenu();
                }
                initializeAuthView();
            };

            document.getElementById('show-login-header').onclick = (e) => { e.preventDefault(); showAuthView(false); };
            document.getElementById('show-register-header').onclick = (e) => { e.preventDefault(); showAuthView(true); };
            document.getElementById('show-login-mobile').onclick = (e) => { e.preventDefault(); showAuthView(false); };
            document.getElementById('show-register-mobile').onclick = (e) => { e.preventDefault(); showAuthView(true); };
            
            document.getElementById('start-earning-btn').onclick = (e) => { e.preventDefault(); showAuthView(true); };

            initializeRealtimeStats();
        }

        function initializeRealtimeStats() {
            const statsRef = ref(database, 'publicStats');
            onValue(statsRef, (snapshot) => {
                if (snapshot.exists()) {
                    const stats = snapshot.val();
                    const animateValue = (element, start, end, duration) => {
                        if (!element) return;
                        let startTimestamp = null;
                        const step = (timestamp) => {
                            if (!startTimestamp) startTimestamp = timestamp;
                            const progress = Math.min((timestamp - startTimestamp) / duration, 1);
                            element.textContent = Math.floor(progress * (end - start) + start).toLocaleString();
                            if (progress < 1) window.requestAnimationFrame(step);
                        };
                        window.requestAnimationFrame(step);
                    };
                    const usersEl = document.getElementById('stats-users'), jobsEl = document.getElementById('stats-jobs'), tasksEl = document.getElementById('stats-tasks'), paidEl = document.getElementById('stats-paid');
                    if(usersEl) animateValue(usersEl, parseInt((usersEl.textContent || '0').replace(/,/g, '')), stats.totalUsers || 0, 1500);
                    if(jobsEl) animateValue(jobsEl, parseInt((jobsEl.textContent || '0').replace(/,/g, '')), stats.jobPosted || 0, 1500);
                    if(tasksEl) animateValue(tasksEl, parseInt((tasksEl.textContent || '0').replace(/,/g, '')), stats.taskDone || 0, 1500);
                    if(paidEl) animateValue(paidEl, parseInt((paidEl.textContent || '0').replace(/,/g, '')), stats.paidAmount || 0, 1500);
                }
            }, { once: true });
        }
        
        function initializeAuthView() {
            showLoader(false);
            const loginForm = document.getElementById('login-form'),
                registerForm = document.getElementById('register-form'),
                forgotPasswordForm = document.getElementById('forgot-password-form'),
                showRegister = document.getElementById('show-register'),
                showLogin = document.getElementById('show-login'),
                showForgotPassword = document.getElementById('show-forgot-password'),
                backToLogin = document.getElementById('back-to-login'),
                loginBox = document.getElementById('login-box'),
                registerBox = document.getElementById('register-box'),
                forgotPasswordBox = document.getElementById('forgot-password-box'),
                authErrorMessage = document.getElementById('auth-error-message');

            const urlParams = new URLSearchParams(window.location.search);
            const refCode = urlParams.get('ref');
            if (refCode) {
                const referInput = document.getElementById('register-refer-code');
                referInput.value = refCode.trim().toUpperCase();
                referInput.disabled = true;
                loginBox.style.display = 'none';
                registerBox.style.display = 'block';
            }

            // --- START: Password Toggle Logic ---
            const eyeIconSVG = `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M2.036 12.322a1.012 1.012 0 0 1 0-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178Z" /><path stroke-linecap="round" stroke-linejoin="round" d="M15 12a3 3 0 1 1-6 0 3 3 0 0 1 6 0Z" /></svg>`;
            const eyeSlashIconSVG = `<svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M3.98 8.223A10.477 10.477 0 0 0 1.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.451 10.451 0 0 1 12 4.5c4.756 0 8.773 3.162 10.065 7.498a10.522 10.522 0 0 1-4.293 5.774M6.228 6.228 3 3m3.228 3.228 3.65 3.65m7.894 7.894L21 21m-3.228-3.228-3.65-3.65m0 0a3 3 0 1 0-4.243-4.243m4.243 4.243L6.228 6.228" /></svg>`;

            document.querySelectorAll('.password-toggle').forEach(toggle => {
                toggle.innerHTML = eyeIconSVG; // Set initial icon
                toggle.addEventListener('click', () => {
                    const inputId = toggle.dataset.for;
                    const passwordInput = document.getElementById(inputId);
                    if (passwordInput.type === "password") {
                        passwordInput.type = "text";
                        toggle.innerHTML = eyeSlashIconSVG;
                    } else {
                        passwordInput.type = "password";
                        toggle.innerHTML = eyeIconSVG;
                    }
                });
            });
            // --- END: Password Toggle Logic ---


            const switchToLogin = (e) => {
                if(e) e.preventDefault();
                registerBox.style.display = 'none';
                forgotPasswordBox.style.display = 'none';
                loginBox.style.display = 'block';
                authErrorMessage.style.display = 'none';
            };

            const switchToRegister = (e) => {
                if(e) e.preventDefault();
                loginBox.style.display = 'none';
                forgotPasswordBox.style.display = 'none';
                registerBox.style.display = 'block';
                authErrorMessage.style.display = 'none';
            };

            const switchToForgot = (e) => {
                if(e) e.preventDefault();
                loginBox.style.display = 'none';
                registerBox.style.display = 'none';
                forgotPasswordBox.style.display = 'block';
                authErrorMessage.style.display = 'none';
            };
            
            showRegister.onclick = switchToRegister;
            showLogin.onclick = switchToLogin;
            showForgotPassword.onclick = switchToForgot;
            backToLogin.onclick = switchToLogin;

            loginForm.onsubmit = e => {
                e.preventDefault();
                showLoader(true);
                authErrorMessage.style.display = 'none';
                signInWithEmailAndPassword(auth, loginForm['login-email'].value, loginForm['login-password'].value)
                    .catch(err => {
                        if (err.code === 'auth/invalid-login-credentials' || err.code === 'auth/wrong-password' || err.code === 'auth/user-not-found') {
                            authErrorMessage.textContent = "আপনার দেওয়া ইমেইল অথবা পাসওয়ার্ড সঠিক নয়।";
                        } else {
                            authErrorMessage.textContent = "একটি অপ্রত্যাশিত সমস্যা হয়েছে। অনুগ্রহ করে আবার চেষ্টা করুন।";
                        }
                        authErrorMessage.style.display = 'block';
                    })
                    .finally(() => showLoader(false));
            };
            
            forgotPasswordForm.onsubmit = e => {
                e.preventDefault();
                showLoader(true);
                authErrorMessage.style.display = 'none';
                const email = forgotPasswordForm['forgot-email'].value;

                sendPasswordResetEmail(auth, email)
                    .then(() => {
                        alert("পাসওয়ার্ড রিসেট করার লিংক আপনার ইমেইলে পাঠানো হয়েছে। অনুগ্রহ করে আপনার ইনবক্স চেক করুন।");
                        switchToLogin();
                    })
                    .catch((error) => {
                        if(error.code === 'auth/user-not-found'){
                            authErrorMessage.textContent = "এই ইমেইল দিয়ে কোনো একাউন্ট খুঁজে পাওয়া যায়নি।";
                        } else {
                            authErrorMessage.textContent = "একটি সমস্যা হয়েছে। অনুগ্রহ করে আবার চেষ্টা করুন।";
                        }
                        authErrorMessage.style.display = 'block';
                    })
                    .finally(() => {
                        showLoader(false);
                    });
            };

            registerForm.onsubmit = async e => {
                e.preventDefault();
                showLoader(true);
                authErrorMessage.style.display = 'none';
                let referredBy = null;
                const referCode = registerForm['register-refer-code'].value.trim().toUpperCase();
            
                if (referCode) {
                    try {
                        const referSnap = await get(ref(database, `referralCodes/${referCode}`));
                        if (!referSnap.exists()) {
                            authErrorMessage.textContent = "আপনার দেওয়া রেফারেল কোডটি সঠিক নয়।";
                            authErrorMessage.style.display = 'block';
                            showLoader(false);
                            return;
                        }
                        referredBy = referSnap.val();
                    } catch (dbError) {
                        authErrorMessage.textContent = dbError.message;
                        authErrorMessage.style.display = 'block';
                        showLoader(false);
                        return;
                    }
                }
            
                try {
                    const userCredential = await createUserWithEmailAndPassword(auth, registerForm['register-email'].value, registerForm['register-password'].value);
                    const newReferralCode = Math.random().toString(36).substring(2, 9).toUpperCase();
                    const userData = {
                        name: registerForm['register-name'].value,
                        email: userCredential.user.email,
                        balance: 0,
                        referralCode: newReferralCode,
                        createdAt: serverTimestamp(),
                        isActive: false,
                        referredBy: referredBy || null,
                        totalIncome: 0,
                        totalDeposit: 0,
                        tasksCompleted: 0,
                        jobsCreated: 0,
                        totalReferrals: 0,
                        referralIncome: 0,
                        totalWithdraw: 0
                    };
            
                    const updates = {};
                    updates[`/users/${userCredential.user.uid}`] = userData;
                    updates[`/referralCodes/${newReferralCode}`] = userCredential.user.uid;
            
                    await update(ref(database), updates);
            
                } catch (error) {
                    if (error.code === 'auth/email-already-in-use') {
                        authErrorMessage.textContent = "এই ইমেইলটি দিয়ে ইতিমধ্যে রেজিস্টার করা হয়েছে। অনুগ্রহ করে লগইন করুন।";
                    } else if (error.code === 'auth/weak-password') {
                        authErrorMessage.textContent = "আপনার পাসওয়ার্ডটি দুর্বল। পাসওয়ার্ড কমপক্ষে ৬ অক্ষরের হতে হবে।";
                    } else {
                        authErrorMessage.textContent = "একটি ত্রুটি হয়েছে। অনুগ্রহ করে আবার চেষ্টা করুন।";
                    }
                    authErrorMessage.style.display = 'block';
                } finally {
                    showLoader(false);
                }
            };
        }

        async function uploadImage(file) {
            if (!IMAGE_HOSTING_API_KEY || IMAGE_HOSTING_API_KEY === "YOUR_IMGBB_API_KEY") throw new Error("Image hosting is not configured.");
            const formData = new FormData(); formData.append('image', file);
            const response = await fetch(`https://api.imgbb.com/1/upload?key=${IMAGE_HOSTING_API_KEY}`, { method: 'POST', body: formData });
            const result = await response.json();
            if (!result.success) throw new Error(`Image upload failed: ${result.error.message}`);
            return result.data.url;
        }
        
        async function fetchAppSettings() {
            try {
                const settingsSnap = await get(ref(database, 'settings'));
                appSettings = settingsSnap.exists() ? settingsSnap.val() : {};
            } catch (error) { console.error("Failed to fetch app settings:", error); appSettings = {}; }
        }
        
        async function initializeUserPanel() {
            await fetchAppSettings();
            const appContent = document.getElementById('app-content'), navItems = document.querySelectorAll('.nav-item'), proofModal = document.getElementById('proof-modal'), proofModalBody = document.getElementById('proof-modal-body'), profileModal = document.getElementById('profile-modal'), editProfileModal = document.getElementById('edit-profile-modal');
            document.getElementById('close-proof-modal').onclick = () => proofModal.style.display = 'none';
            document.getElementById('user-profile-header-btn').onclick = () => {
                const liveSupportBtn = document.getElementById('live-support-btn');
                if (appSettings.liveSupportLink) { 
                    liveSupportBtn.href = appSettings.liveSupportLink; 
                    liveSupportBtn.style.display = 'flex'; 
                } else { 
                    liveSupportBtn.style.display = 'none'; 
                }
                profileModal.style.display = 'flex';
            };
            document.getElementById('close-profile-modal').onclick = () => profileModal.style.display = 'none';
            document.getElementById('main-logout-btn').onclick = () => signOut(auth);
            document.getElementById('show-edit-profile-btn').onclick = () => {
                profileModal.style.display = 'none';
                document.getElementById('edit-profile-name').value = activeUserData.name || '';
                document.getElementById('edit-profile-pic-input').value = '';
                const cropContainer = document.getElementById('image-crop-container');
                cropContainer.style.display = 'none';
                if (cropper) cropper.destroy();
                editProfileModal.style.display = 'flex';
            };
            document.getElementById('cancel-edit-profile').onclick = () => editProfileModal.style.display = 'none';
            const imageInput = document.getElementById('edit-profile-pic-input'), imageToCrop = document.getElementById('image-to-crop'), cropContainer = document.getElementById('image-crop-container');
            imageInput.addEventListener('change', (e) => {
                const files = e.target.files;
                if (files && files.length > 0) {
                    const reader = new FileReader();
                    reader.onload = () => {
                        imageToCrop.src = reader.result;
                        cropContainer.style.display = 'block';
                        if (cropper) cropper.destroy();
                        cropper = new Cropper(imageToCrop, { aspectRatio: 1, viewMode: 1, background: false, modal: false });
                    };
                    reader.readAsDataURL(files[0]);
                }
            });
            document.getElementById('edit-profile-form').onsubmit = async (e) => {
                e.preventDefault(); showLoader(true); const newName = document.getElementById('edit-profile-name').value.trim(); const updates = { name: newName };
                try {
                    if (cropper && imageInput.files.length > 0) {
                        const canvas = cropper.getCroppedCanvas({ width: 256, height: 256 });
                        const blob = await new Promise(resolve => canvas.toBlob(resolve, 'image/jpeg'));
                        const imageFile = new File([blob], "profile.jpg", { type: "image/jpeg" });
                        updates.profilePicture = await uploadImage(imageFile);
                    }
                    await update(ref(database, `users/${currentUserId}`), updates);
                    alert("Profile updated successfully!"); editProfileModal.style.display = 'none';
                } catch (error) { alert("Failed to update profile: " + error.message); } finally { showLoader(false); }
            };

            const handleRouting = (userData) => {
                const [hash, params] = (window.location.hash.substring(1) || 'home').split('?');
                const urlParams = new URLSearchParams(params);

                navItems.forEach(item => item.classList.toggle('active', item.dataset.page === hash));

                if (userData.isActive === false) {
                    if (['home', 'wallet', ''].includes(hash)) {
                        renderActivationPage(userData);
                    } else {
                        appContent.innerHTML = `<div class="card alert-card alert-inactive"><h3>Account Not Active</h3><p>Please activate your account to access this feature.</p></div>`;
                    }
                } else {
                    if (hash === 'task-details' && urlParams.has('id')) {
                        renderTaskDetailsPage(urlParams.get('id'), userData);
                    } else {
                        const route = routes[hash] || routes.home;
                        route(userData);
                    }
                }
            };
            
            userDataUnsubscribe = onValue(ref(database, `users/${currentUserId}`), (snapshot) => {
                if (!snapshot.exists()) { signOut(auth); return; }
                activeUserData = { uid: currentUserId, ...snapshot.val() };
                document.getElementById('user-name').textContent = activeUserData.name;
                const profileIcon = document.getElementById('profile-icon');
                profileIcon.src = activeUserData.profilePicture ? activeUserData.profilePicture : `https://api.dicebear.com/7.x/initials/svg?seed=${encodeURIComponent(activeUserData.name)}`;
                document.getElementById('user-balance-val').textContent = (activeUserData.balance || 0).toFixed(2);
                handleRouting(activeUserData);
            }, (error) => { console.error("Firebase Error:", error); signOut(auth); });
            
            const genericIcon = `<svg fill="#9E9E9E" viewBox="0 0 24 24"><path d="M12,16A2,2 0 0,1 14,18A2,2 0 0,1 12,20A2,2 0 0,1 10,18A2,2 0 0,1 12,16M12,10A2,2 0 0,1 14,12A2,2 0 0,1 12,14A2,2 0 0,1 10,12A2,2 0 0,1 12,10M12,4A2,2 0 0,1 14,6A2,2 0 0,1 12,8A2,2 0 0,1 10,6A2,2 0 0,1 12,4Z"/></svg>`;

            const categoryDetails = {
                'YouTube': { name: 'YouTube', icon: `<svg fill="#FF0000" viewBox="0 0 24 24"><path d="M10,15L15.19,12L10,9V15M21.56,7.17C21.69,7.64 21.78,8.27 21.84,9.07C21.91,9.87 21.94,10.56 21.94,11.16L22,12C22,12.44 21.97,13.13 21.91,13.93C21.84,14.73 21.75,15.36 21.62,15.83C21.26,17.22 20.12,18.17 18.73,18.53C18.26,18.66 17.63,18.75 16.83,18.81C16.03,18.88 15.34,18.91 14.84,18.91L14,19H10C9.56,19 8.87,18.97 8.07,18.91C7.27,18.84 6.64,18.75 6.17,18.62C4.78,18.26 3.83,17.12 3.47,15.73C3.34,15.26 3.25,14.63 3.19,13.83C3.12,13.03 3.09,12.44 3.09,12L3,11.16C3,10.56 3.03,9.87 3.09,9.07C3.16,8.27 3.25,7.64 3.38,7.17C3.74,5.78 4.88,4.83 6.27,3.47C6.74,3.34 7.37,3.25 8.17,3.19C8.97,3.12 10.66,3.09 11.16,3.09L12,3H13C13.44,3 14.13,3.03 14.93,3.09C15.73,3.16 16.36,3.25 16.83,3.38C18.22,3.74 19.17,4.88 19.53,6.27C19.66,6.74 19.75,7.37 19.81,8.17C19.88,8.97 19.91,9.56 19.91,10.16L20,11V12Z"/></svg>` },
                'Facebook': { name: 'Facebook', icon: `<svg fill="#1877F2" viewBox="0 0 24 24"><path d="M12 2.04C6.5 2.04 2 6.53 2 12.06C2 17.06 5.66 21.21 10.44 21.96V14.96H7.9V12.06H10.44V9.85C10.44 7.32 11.93 5.96 14.22 5.96C15.31 5.96 16.45 6.15 16.45 6.15V8.62H15.19C13.95 8.62 13.56 9.39 13.56 10.18V12.06H16.34L15.89 14.96H13.56V21.96C18.34 21.21 22 17.06 22 12.06C22 6.53 17.5 2.04 12 2.04Z"/></svg>` },
                'Instagram': { name: 'Instagram', icon: `<svg viewBox="0 0 24 24" fill="url(#instagram-gradient)"><defs><linearGradient id="instagram-gradient" x1="50%" y1="0%" x2="50%" y2="100%"><stop offset="0%" stop-color="#833ab4"></stop><stop offset="50%" stop-color="#fd1d1d"></stop><stop offset="100%" stop-color="#fcb045"></stop></linearGradient></defs><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.85s-.011 3.584-.069 4.85c-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07s-3.584-.012-4.85-.07c-3.252-.148-4.771-1.691-4.919-4.919-.058-1.265-.069-1.645-.069-4.85s.011-3.584.069-4.85c.149-3.225 1.664-4.771 4.919-4.919C8.416 2.175 8.796 2.163 12 2.163m0-2.163C8.74 0 8.333.01 7.053.062c-4.444.2-7.008 2.764-7.21 7.21C-.05 8.333 0 8.74 0 12s.01 3.667.062 4.947c.2 4.444 2.764 7.008 7.21 7.21C8.333 23.99 8.74 24 12 24s3.667-.01 4.947-.062c4.444-.2 7.008-2.764 7.21-7.21.05-1.28.062-1.687.062-4.947s-.01-3.667-.062-4.947c-.2-4.444-2.764-7.008-7.21-7.21C15.667.01 15.26 0 12 0zm0 5.838a6.162 6.162 0 100 12.324 6.162 6.162 0 000-12.324zM12 16a4 4 0 110-8 4 4 0 010 8zm6.406-11.845a1.44 1.44 0 100 2.88 1.44 1.44 0 000-2.88z"/></svg>`},
                'Telegram': { name: 'Telegram', icon: `<svg fill="#2AABEE" viewBox="0 0 24 24"><path d="M9.78 18.65l.28-4.23l7.68-6.92c.2-.18.02-.5-.24-.4L5.6 11.24l-3.23-1.03c-.41-.13-.42-.71.04-.82l15.7-5.55c.4-.14.77.27.6.66L15.14 19.4c-.1.24-.4.3-.64.18l-4.1-2.04l-1.63 1.58c-.19.18-.52.06-.52-.22Z"/></svg>` },
                'SignUp': { name: 'Sign Up', icon: `<svg fill="#4CAF50" viewBox="0 0 24 24"><path d="M15,14C12.33,14 7,15.33 7,18V20H23V18C23,15.33 17.67,14 15,14M15,12A4,4 0 0,0 19,8A4,4 0 0,0 15,4A4,4 0 0,0 11,8A4,4 0 0,0 15,12M5,13.28L1,10.77L2.6,9.5L5,11.5L10.6,4L12,5.27L5,13.28Z"/></svg>` },
                'ReferralSignUp': { name: 'Referral Sign Up', icon: `<svg fill="#7E57C2" viewBox="0 0 24 24"><path d="M16,13c1.1,0,2-0.9,2-2s-0.9-2-2-2s-2,0.9-2,2S14.9,13,16,13z M8,13c1.1,0,2-0.9,2-2s-0.9-2-2-2s-2,0.9-2,2S6.9,13,8,13z M12,14c-1.67,0-5,0.84-5,2.5V18h10v-1.5C17,14.84,13.67,14,12,14z M19,12v-2h-2v2h-2v2h2v2h2v-2h2v-2H19z M8,15c-2.67,0-8,1.34-8,4v3h16v-3C16,16.34,10.67,15,8,15z"/></svg>` },
                'AppInstall': { name: 'App Install', icon: `<svg fill="#FF9800" viewBox="0 0 24 24"><path d="M17,1H7C5.9,1,5,1.9,5,3v18c0,1.1,0.9,2,2,2h10c1.1,0,2-0.9,2-2V3C19,1.9,18.1,1,17,1z M17,19H7V5h10V19z M12,9l-4,4h3v4h2v-4h3L12,9z"/></svg>` },
                'AppInstallAndReview': { name: 'App Install & Review', icon: `<svg fill="#03A9F4" viewBox="0 0 24 24"><path d="M16.5,5L15,3.5L12,6.5L9,3.5L7.5,5L10.5,8L7.5,11L9,12.5L12,9.5L15,12.5L16.5,11L13.5,8M19,12v7H5v-7H3v7c0,1.1,0.9,2,2,2h14c1.1,0,2-0.9,2-2v-7H19z"/></svg>` },
                'PCDesktopTask': { name: 'PC/Desktop Task', icon: `<svg fill="#37474F" viewBox="0 0 24 24"><path d="M20,18H4V8H20M20,6H4A2,2 0 0,0 2,8V18A2,2 0 0,0 4,20H11V22H9V24H15V22H13V20H20A2,2 0 0,0 22,18V8A2,2 0 0,0 20,6Z"/></svg>` },
                'SurveyAndQuiz': { name: 'Survey & Quiz', icon: `<svg fill="#6D4C41" viewBox="0 0 24 24"><path d="M14,10H12V12H14M14,6H12V8H14M12,16H14V14H12M20,4H4A2,2 0 0,0 2,6V18A2,2 0 0,0 4,20H20A2,2 0 0,0 22,18V6A2,2 0 0,0 20,4Z"/></svg>` },
                'Others': { name: 'Others', icon: genericIcon },
                'TikTok': { name: 'TikTok', icon: genericIcon },
                'TwitterX': { name: 'Twitter / X', icon: genericIcon },
                'WebVisit': { name: 'Web Visit', icon: genericIcon },
                'WriteAReview': { name: 'Write a Review', icon: genericIcon },
                'AdsClick': { name: 'Ads Click', icon: genericIcon },
                'AirdropJoin': { name: 'Airdrop Join', icon: genericIcon },
                'Answers': { name: 'Answers', icon: genericIcon },
                'AppPreTester': { name: 'App Pre-Tester', icon: genericIcon },
                'Assignment': { name: 'Assignment', icon: genericIcon },
                'AudioMack': { name: 'Audio Mack', icon: genericIcon },
                'BackLink': { name: 'Back Link', icon: genericIcon },
                'Blog': { name: 'Blog', icon: genericIcon },
                'Comment': { name: 'Comment', icon: genericIcon },
                'Discord': { name: 'Discord', icon: genericIcon },
                'Edit': { name: 'Edit', icon: genericIcon },
                'FacebookInvite': { name: 'Facebook Invite', icon: genericIcon },
                'Fiverr': { name: 'Fiverr', icon: genericIcon },
                'GmailAccount': { name: 'Gmail Account', icon: genericIcon },
                'GraphicsDesign': { name: 'Graphics Design', icon: genericIcon },
                'KycSubmit': { name: 'KYC Submit', icon: genericIcon },
                'Linkedin': { name: 'LinkedIn', icon: genericIcon },
                'Medium': { name: 'Medium', icon: genericIcon },
                'MobileApplication': { name: 'Mobile Application', icon: genericIcon },
                'NeedFollower': { name: 'Need Follower', icon: genericIcon },
                'Promotion': { name: 'Promotion', icon: genericIcon },
                'Quora': { name: 'Quora', icon: genericIcon },
                'Reddit': { name: 'Reddit', icon: genericIcon },
                'ReelShort': { name: 'Reel / Short', icon: genericIcon },
                'Review': { name: 'Review', icon: genericIcon },
                'SearchClick': { name: 'Search / Click', icon: genericIcon },
                'Share': { name: 'Share', icon: genericIcon },
                'Story': { name: 'Story', icon: genericIcon },
                'Typing': { name: 'Typing', icon: genericIcon },
                'Views': { name: 'Views', icon: genericIcon },
                'Visitor': { name: 'Visitor', icon: genericIcon },
                'Website': { name: 'Website', icon: genericIcon },
                'WhatsApp': { name: 'WhatsApp', icon: genericIcon },
                'WriteAnArticle': { name: 'Write an Article', icon: genericIcon }
            };

            const getCategoryDisplayName = (categoryKey) => (categoryDetails[categoryKey] ? categoryDetails[categoryKey].name : categoryKey);

            const renderHomePage = async (currentUserData) => {
                showLoader(true);
                const q=query(ref(database,'users'),orderByChild('referredBy'),equalTo(currentUserData.uid));
                const [referralsSnap,submissionsSnap]=await Promise.all([get(q),get(ref(database,`submissions/${currentUserData.uid}`))]);
                const referralsCount=referralsSnap.exists()?referralsSnap.size:0; const settings = appSettings; let approvedJobs=0;
                if(submissionsSnap.exists()){Object.values(submissionsSnap.val()).forEach(sub=>{if(sub.status==='approved')approvedJobs++;});}
                let socialLinksHTML='';
                if(settings.telegramLink)socialLinksHTML+=`<a href="${settings.telegramLink}" target="_blank" class="social-icon" title="Telegram"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M9.78 18.65l.28-4.23l7.68-6.92c.2-.18.02-.5-.24-.4L5.6 11.24l-3.23-1.03c-.41-.13-.42-.71.04-.82l15.7-5.55c.4-.14.77.27.6.66L15.14 19.4c-.1.24-.4.3-.64.18l-4.1-2.04l-1.63 1.58c-.19.18-.52.06-.52-.22Z"/></svg></a>`;
                if(settings.youtubeLink)socialLinksHTML+=`<a href="${settings.youtubeLink}" target="_blank" class="social-icon" title="YouTube"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M10,15L15.19,12L10,9V15M21.56,7.17C21.69,7.64 21.78,8.27 21.84,9.07C21.91,9.87 21.94,10.56 21.94,11.16L22,12C22,12.44 21.97,13.13 21.91,13.93C21.84,14.73 21.75,15.36 21.62,15.83C21.26,17.22 20.12,18.17 18.73,18.53C18.26,18.66 17.63,18.75 16.83,18.81C16.03,18.88 15.34,18.91 14.84,18.91L14,19H10C9.56,19 8.87,18.97 8.07,18.91C7.27,18.84 6.64,18.75 6.17,18.62C4.78,18.26 3.83,17.12 3.47,15.73C3.34,15.26 3.25,14.63 3.19,13.83C3.12,13.03 3.09,12.44 3.09,12L3,11.16C3,10.56 3.03,9.87 3.09,9.07C3.16,8.27 3.25,7.64 3.38,7.17C3.74,5.78 4.88,4.83 6.27,3.47C6.74,3.34 7.37,3.25 8.17,3.19C8.97,3.12 10.66,3.09 11.16,3.09L12,3H13C13.44,3 14.13,3.03 14.93,3.09C15.73,3.16 16.36,3.25 16.83,3.38C18.22,3.74 19.17,4.88 19.53,6.27C19.66,6.74 19.75,7.37 19.81,8.17C19.88,8.97 19.91,9.56 19.91,10.16L20,11V12Z"/></svg></a>`;
                if(settings.facebookLink)socialLinksHTML+=`<a href="${settings.facebookLink}" target="_blank" class="social-icon" title="Facebook"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2.04C6.5 2.04 2 6.53 2 12.06C2 17.06 5.66 21.21 10.44 21.96V14.96H7.9V12.06H10.44V9.85C10.44 7.32 11.93 5.96 14.22 5.96C15.31 5.96 16.45 6.15 16.45 6.15V8.62H15.19C13.95 8.62 13.56 9.39 13.56 10.18V12.06H16.34L15.89 14.96H13.56V21.96C18.34 21.21 22 17.06 22 12.06C22 6.53 17.5 2.04 12 2.04Z"/></svg></a>`;
                appContent.innerHTML=`<div class="home-header"><h2>Welcome, ${currentUserData.name}!</h2><p>Your Current Balance</p><div class="home-balance"><sup>৳</sup>${(currentUserData.balance||0).toFixed(2)}</div><a href="#wallet" class="button">Deposit Funds</a></div>
                <div class="card"><div class="stat-grid"><div class="stat-item"><div class="icon"><svg viewBox="0 0 24 24"><path d="M7,15H9V17H7V15M7,11H9V13H7V11M7,7H9V9H7V7M11,15H13V17H11V15M11,11H13V13H11V11M11,7H13V9H11V7M15,15H17V17H15V15M15,11H17V13H15V11M15,7H17V9H15V7M19,3H5C3.89,3 3,3.9 3,5V19C3,20.1 3.9,21 5,21H19C20.1,21 21,20.1 21,19V5C21,3.9 20.1,3 19,3Z"/></svg></div><h4>${(currentUserData.totalIncome||0).toFixed(2)}</h4><p>Total Income</p></div><div class="stat-item"><div class="icon"><svg viewBox="0 0 24 24"><path d="M12,2C17.5,2 22,6.5,22,12C22,17.5 17.5,22 12,22C6.5,22,2,17.5,2,12C2,6.5,6.5,2,12,2M11,16.5L18,9.5L16.6,8.1L11,13.7L7.4,10.1L6,11.5L11,16.5Z"/></svg></div><h4>${currentUserData.tasksCompleted||0}</h4><p>Tasks Done</p></div><div class="stat-item"><div class="icon"><svg viewBox="0 0 24 24"><path d="M16,13C17.66,13,19,11.66,19,10C19,8.34,17.66,7,16,7C14.34,7,13,8.34,13,10C13,11.66,14.34,13,16,13M8,13C9.66,13,11,11.66,11,10C11,8.34,9.66,7,8,7C6.34,7,5,8.34,5,10C5,11.66,6.34,13,8,13M8,15C5.67,15,1,16.17,1,18.5V21H15V18.5C15,16.17,10.33,15,8,15M16,15C15.71,15,15.38,15.02,15.03,15.05C16.19,15.89,17,17.12,17,18.5V21H23V18.5C23,16.17,18.33,15,16,15Z"/></svg></div><h4>${referralsCount}</h4><p>Total Referrals</p></div><div class="stat-item"><div class="icon"><svg viewBox="0 0 24 24"><path d="M12,8A3,3 0 0,0 9,11A3,3 0 0,0 12,14A3,3 0 0,0 15,11A3,3 0 0,0 12,8M12,16C9.79,16 8,14.21 8,12C8,9.79 9.79,8 12,8C14.21,8 16,9.79 16,12C16,14.21 14.21,16 12,16M12,2A10,10 0 0,0 2,12A10,10 0 0,0 12,22A10,10 0 0,0 22,12A10,10 0 0,0 12,2Z"/></svg></div><h4>${(currentUserData.referralIncome||0).toFixed(2)}</h4><p>Referral Income</p></div><div class="stat-item"><div class="icon"><svg viewBox="0 0 24 24"><path d="M14 14.5V16.5H16V14.5H14M14 10.5V12.5H16V10.5H14M14 6.5V8.5H16V6.5H14M18 20V4H6V20H18M18 2H6C4.9 2 4 2.9 4 4V20C4 21.1 4.9 22 6 22H18C19.1 22 20 21.1 20 20V4C20 2.9 19.1 2 18 2M8 18H12V16.5H8V18M8 14H12V12.5H8V14M8 10H12V8.5H8V10Z"/></svg></div><h4>${(currentUserData.totalDeposit||0).toFixed(2)}</h4><p>Total Deposit</p></div><div class="stat-item"><div class="icon"><svg viewBox="0 0 24 24"><path d="M19 3H5C3.9 3 3 3.9 3 5V19C3 20.1 3.9 21 5 21H19C20.1 21 21 20.1 21 19V5C21 3.9 20.1 3 19 3M18 14H6V12H18V14Z"/></svg></div><h4>${(currentUserData.totalWithdraw||0).toFixed(2)}</h4><p>Total Withdraw</p></div><div class="stat-item"><div class="icon"><svg viewBox="0 0 24 24"><path d="M9,20.42L10.41,21.83L13.24,19L16.07,21.83L17.48,20.42L14.65,17.59L17.48,14.76L16.07,13.35L13.24,16.18L10.41,13.35L9,14.76L11.83,17.59L9,20.42M19,3A2,2 0 0,1 21,5V12.08L14.03,19.05C13.68,19.4 13.05,19.4 12.7,19.05L7.95,14.3C7.6,13.95 7.6,13.32 7.95,12.97L14.92,6H11V4H19V12H17V8.41L11.41,14L13.24,15.83L19,10.08V19H5V5H14V3H5A2,2 0 0,0 3,5V19A2,2 0 0,0 5,21H13.24L19.6,14.65C20.45,13.8 20.45,12.5 19.6,11.65L15.35,7.4L19,3.79V3Z"/></svg></div><h4>${currentUserData.jobsCreated||0}</h4><p>Jobs Posted</p></div><div class="stat-item"><div class="icon"><svg viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"/></svg></div><h4>${approvedJobs}</h4><p>Approved Jobs</p></div></div></div>
                <div class="card quick-actions"><a href="#tasks" class="button"><svg viewBox="0 0 24 24"><path d="M14,2H6A2,2 0 0,0 4,4V20A2,2 0 0,0 6,22H18A2,2 0 0,0 20,20V8L14,2M13.5,16V14.5H16.5V16H13.5M13.5,13V11.5H16.5V13H13.5M9,18H12V19.5H9V18M13,9V3.5L18.5,9H13Z"></path></svg> <span>Start a New Task</span></a><a href="#refer" class="button"><svg viewBox="0 0 24 24"><path d="M12,5.5A3.5,3.5 0 0,1 15.5,9A3.5,3.5 0 0,1 12,12.5A3.5,3.5 0 0,1 8.5,9A3.5,3.5 0 0,1 12,5.5M5,8C5.56,8 6.08,8.15 6.53,8.42L8.65,6.3C8.26,5.8 8,5.17 8,4.5A2.5,2.5 0 0,1 10.5,2A2.5,2.5 0 0,1 13,4.5C13,5.17 12.74,5.8 12.35,6.3L14.47,8.42C14.92,8.15 15.44,8 16,8A3,3 0 0,1 19,11A3,3 0 0,1 16,14A3,3 0 0,1 13,11C13,10.64 13.06,10.29 13.16,9.97L10.91,7.72C10.05,8.5 9,8.7 8.16,8.28L6,10.44V10.5A2.5,2.5 0 0,1 8.5,13A2.5,2.5 0 0,1 6,10.5C6,9.83 6.26,9.2 6.65,8.7L5,7.05C5,7.35 5,7.67 5,8M16,10A1,1 0 0,0 15,11A1,1 0 0,0 16,12A1,1 0 0,0 17,11A1,1 0 0,0 16,10Z"></path></svg> <span>Refer & Earn More</span></a></div>
                <div class="card"><h4 style="text-align:center;">Join Our Community</h4><div class="social-links">${socialLinksHTML}</div></div>`;
                showLoader(false);
            };

            const renderActivationPage = (currentUserData) => {
                const activationSnapPromise = get(ref(database, `activations/${currentUserData.uid}`));
                activationSnapPromise.then(activationSnap => {
                    const settings = appSettings;
                    const content = activationSnap.exists() && activationSnap.val().status === 'pending'
                        ? `<div class="card alert-card alert-pending"><h3>Activation Pending</h3><p>Your account activation request is under review.</p><p><b>Your Submitted TrxID:</b> ${activationSnap.val().trxId}</p></div>`
                        : `<div class="card activation-card"><h3>Activate Your Account</h3><p>Activate your account by paying the fee of ৳${settings.activationFee || 20}.</p>
                           <h4>Payment Instructions</h4><p>Send ৳${settings.activationFee || 20} to the number below and submit the Transaction ID.</p>
                           <div class="payment-info"><span>${settings.depositNumber || "N/A"} (${settings.depositMethod || ""})</span><button class="copy-btn" onclick="copyToClipboard('${settings.depositNumber || ""}')">Copy</button></div>
                           <form id="activation-form" style="margin-top:1.5rem;"><label>Transaction ID (TrxID)</label><input type="text" id="activation-trxid" required><button type="submit">Submit</button></form></div>`;
                    appContent.innerHTML = content + `<button id="logout-btn" class="button logout-button">Logout</button>`;
                    if (document.getElementById('activation-form')) document.getElementById('activation-form').onsubmit = (e) => handleActivationSubmit(e, currentUserData);
                    document.getElementById('logout-btn').onclick = () => signOut(auth);
                });
            };

            const handleActivationSubmit = async (e, currentUserData) => { e.preventDefault(); const form = e.target; const trxId = form.querySelector('#activation-trxid').value.trim(); if (!trxId) return; showLoader(true); form.querySelector('button').disabled = true; form.querySelector('button').textContent = "Submitting..."; try { await set(ref(database, `activations/${currentUserData.uid}`), { userId: currentUserData.uid, name: currentUserData.name, status: 'pending', trxId, timestamp: serverTimestamp() }); alert('Your request has been submitted successfully!'); renderActivationPage(currentUserData); } catch (error) { alert("Submission failed."); form.querySelector('button').disabled = false; form.querySelector('button').textContent = "Submit"; } finally { showLoader(false); } };

            const renderTasksListPage = async (currentUserData) => {
                showLoader(true);
                appContent.innerHTML = `<h3>Available Jobs</h3><div id="job-list-container"></div>`;
                const jobListContainer = document.getElementById('job-list-container');
                
                const [tasksSnap, allSubmissionsSnap, userSubsSnap] = await Promise.all([
                    get(ref(database, 'tasks')), 
                    get(ref(database, 'task_submissions')),
                    get(ref(database, `submissions/${currentUserData.uid}`))
                ]);

                const userSubmissions = userSubsSnap.exists() ? Object.keys(userSubsSnap.val()) : [];
                const allTasks = [];
                 if (tasksSnap.exists()) {
                    tasksSnap.forEach(child => {
                        allTasks.push({ id: child.key, ...child.val() });
                    });
                    allTasks.reverse();
                }
                const allSubmissions = allSubmissionsSnap.exists() ? allSubmissionsSnap.val() : {};

                let tasksFound = false;
                jobListContainer.innerHTML = '';

                for (const task of allTasks) {
                    const completedSubmissions = allSubmissions[task.id] ? Object.values(allSubmissions[task.id]).filter(s => s.status === 'approved').length : 0;
                    
                    if (completedSubmissions >= task.quantity || task.creatorId === currentUserData.uid || userSubmissions.includes(task.id)) {
                        continue;
                    }
                    
                    tasksFound = true;
                    const progressPercent = (completedSubmissions / task.quantity) * 100;
                    const defaultThumb = 'https://via.placeholder.com/60';

                    jobListContainer.innerHTML += `
                        <div class="job-card-item" data-task-id="${task.id}">
                            <img src="${task.thumbnailUrl || defaultThumb}" alt="Job thumbnail" class="job-card-thumb" loading="lazy">
                            <div class="job-card-details">
                                <div class="job-card-title">${task.title}</div>
                                <div class="progress-bar" style="height:6px; margin: 0.5rem 0;"><div class="progress-bar-inner" style="width:${progressPercent}%"></div></div>
                                <div class="job-card-footer">
                                    <span class="job-card-progress-text">${completedSubmissions} of ${task.quantity} done</span>
                                    <span class="job-card-reward">৳${task.reward.toFixed(3)}</span>
                                </div>
                            </div>
                        </div>
                    `;
                }

                if (!tasksFound) {
                    jobListContainer.innerHTML = `<div class="card"><p>No new jobs available for you right now.</p></div>`;
                }
                
                jobListContainer.querySelectorAll('.job-card-item').forEach(card => {
                    card.onclick = () => window.location.hash = `#task-details?id=${card.dataset.taskId}`;
                });

                showLoader(false);
            };

            const renderTaskDetailsPage = async (taskId, currentUserData) => {
                showLoader(true);
                const taskSnap = await get(ref(database, `tasks/${taskId}`));
                if (!taskSnap.exists()) {
                    appContent.innerHTML = `<div class="card"><p>Job not found or has been removed.</p></div>`;
                    showLoader(false); return;
                }

                const task = taskSnap.val();
                const screenshotsRequired = task.screenshotsRequired || 1;

                appContent.innerHTML = `
                    <button class="back-button" onclick="window.location.hash = '#tasks'"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg> Back to Jobs</button>
                    <div class="card">
                        <div class="task-details-header">
                             ${task.thumbnailUrl ? `<img src="${task.thumbnailUrl}" alt="Task Thumbnail" loading="lazy">` : ''}
                            <h3>${task.title}</h3>
                            <p><strong>Category:</strong> ${getCategoryDisplayName(task.category)} | <strong>Reward:</strong> ৳${task.reward}</p>
                        </div>
                        <div class="task-details-body">
                            <h4>What is expected from workers?</h4>
                            <p>${(task.description || '').replace(/\n/g, '<br>')}</p>

                            <h4>Submit your proofs below:</h4>
                            <p>${(task.requiredProof || 'Submit proof of task completion.').replace(/\n/g, '<br>')}</p>
                            
                            <form id="task-submission-form" style="margin-top:1.5rem;">
                                <label>Submit Proof (${screenshotsRequired} Screenshot${screenshotsRequired > 1 ? 's' : ''})</label>
                                <input type="file" accept="image/*" required multiple>
                                <label style="margin-top:1rem;">Additional Proof (Optional)</label>
                                <input type="text" class="text-proof-input" placeholder="Enter proof (e.g., your username)">
                                <button type="submit">Submit Proof</button>
                            </form>
                        </div>
                    </div>`;

                appContent.querySelector('#task-submission-form').onsubmit = e => handleTaskSubmission(e, currentUserData, taskId);
                showLoader(false);
            };


            const handleTaskSubmission = async (e, currentUserData, taskId) => {
                e.preventDefault();
                const form = e.target, files = form.querySelector('input[type=file]').files, textProof = form.querySelector('.text-proof-input').value.trim();
                const taskSnap = await get(ref(database, `tasks/${taskId}`)), task = taskSnap.val();
                const screenshotsRequired = task.screenshotsRequired || 1;
                if (files.length < screenshotsRequired) return alert(`Please upload at least ${screenshotsRequired} screenshot(s).`);
                showLoader(true); form.querySelector('button').disabled = true;
                try {
                    const imageUrls = await Promise.all(Array.from(files).map(file => uploadImage(file)));
                    const submissionData = { status: 'pending', textProof, proofImages: imageUrls, timestamp: serverTimestamp() };
                    const updates = {[`/submissions/${currentUserData.uid}/${taskId}`]: submissionData, [`/task_submissions/${taskId}/${currentUserData.uid}`]: { ...submissionData, submitterName: currentUserData.name, status: 'pending' }}; 
                    await update(ref(database), updates);
                    alert('Submission successful!'); 
                    window.location.hash = '#tasks';
                } catch (error) { alert(`Submission failed: ${error.message}`); form.querySelector('button').disabled = false; } 
                finally { showLoader(false); }
            };

            const renderAddTaskPage = (currentUserData) => {
                let currentStep = 1;
                let taskData = { thumbnailUrl: null };

                const updateStepView = () => {
                    appContent.querySelectorAll('.add-task-step').forEach(step => step.classList.remove('active'));
                    appContent.querySelector(`#step-${currentStep}`).classList.add('active');
                    appContent.querySelectorAll('.step-indicator').forEach((indicator, index) => {
                        indicator.classList.toggle('active', (index + 1) === currentStep);
                    });
                };

                appContent.innerHTML = `
                    <div class="card">
                        <h3>Create a New Job Post</h3>
                        <div class="step-indicators">
                            <div class="step-indicator active">1</div>
                            <div class="step-indicator">2</div>
                            <div class="step-indicator">3</div>
                        </div>
                        <form id="add-task-form">
                            <div id="step-1" class="add-task-step active">
                                <h4>Job Information</h4>
                                <label>Select Category:</label>
                                <select id="task-category" required><option value="" disabled selected>Loading...</option></select>
                                <label>Write an accurate job Title:</label>
                                <input type="text" id="task-title" required placeholder="e.g., Subscribe to my YouTube channel">
                                <label>Thumbnail Image (Optional):</label>
                                <input type="file" id="task-thumbnail-input" accept="image/*">
                                <img id="add-task-thumbnail-preview" src="#" alt="Thumbnail Preview" loading="lazy"/>
                            </div>
                            <div id="step-2" class="add-task-step">
                                <h4>Task Details</h4>
                                <label>What specific tasks need to be completed?</label>
                                <textarea id="task-description" rows="5" placeholder="e.g., 1. Go to this link...\n2. Subscribe the channel...\n3. Watch any video for 2 minutes." required></textarea>
                                <label>Required proof the job was completed.</label>
                                <textarea id="task-required-proof" rows="3" placeholder="e.g., 1. Provide a screenshot of subscribed channel.\n2. Give your YouTube username." required></textarea>
                            </div>
                            <div id="step-3" class="add-task-step">
                                <h4>Budget & Settings</h4>
                                <label id="task-reward-label">Worker Reward (per task):</label><input type="number" id="task-reward" step="0.01" required>
                                <label>Number of Jobs:</label><input type="number" id="task-quantity" min="10" value="10" required>
                                <label id="screenshots-label">Screenshots Required:</label><input type="number" id="task-screenshots" min="1" value="1" required>
                                <div id="cost-summary-card" class="card" style="background:var(--light-color);text-align:center;margin-top:1rem; display:none;">
                                    <h4>Total Cost</h4>
                                    <p style="font-size:2rem;font-weight:700;color:var(--primary-color);">৳<span id="total-cost">0.00</span></p>
                                </div>
                            </div>
                            <div class="step-navigation">
                                <button type="button" id="back-step-btn" class="button" style="background:var(--grey-color); display:none;">Back</button>
                                <button type="button" id="next-step-btn" class="button">Next</button>
                                <button type="submit" id="submit-task-btn" class="button" style="display:none;">Create Job</button>
                            </div>
                        </form>
                    </div>`;

                const nextBtn = document.getElementById('next-step-btn');
                const backBtn = document.getElementById('back-step-btn');
                const submitBtn = document.getElementById('submit-task-btn');
                
                const form = appContent.querySelector('#add-task-form');
                const categorySelect = form.querySelector('#task-category');

                const validateStep = (step) => {
                    const inputs = appContent.querySelector(`#step-${step}`).querySelectorAll('[required]');
                    for(const input of inputs){
                        if(!input.value.trim()){
                            alert(`Please fill out the "${input.previousElementSibling.textContent}" field.`);
                            return false;
                        }
                    }
                    return true;
                }

                nextBtn.onclick = async () => {
                    if (!validateStep(currentStep)) return;
                    if (currentStep === 1) {
                         const thumbnailInput = document.getElementById('task-thumbnail-input');
                         if(thumbnailInput.files.length > 0){
                            showLoader(true);
                            try {
                                taskData.thumbnailUrl = await uploadImage(thumbnailInput.files[0]);
                            } catch(e) { alert("Thumbnail upload failed!"); taskData.thumbnailUrl = null;}
                             showLoader(false);
                         }
                    }
                    if (currentStep < 3) {
                        currentStep++;
                        backBtn.style.display = 'block';
                        if (currentStep === 3) {
                            nextBtn.style.display = 'none';
                            submitBtn.style.display = 'block';
                            updateFieldsForCategory();
                        }
                        updateStepView();
                    }
                };

                backBtn.onclick = () => {
                    if (currentStep > 1) {
                        currentStep--;
                        nextBtn.style.display = 'block';
                        submitBtn.style.display = 'none';
                        if (currentStep === 1) {
                            backBtn.style.display = 'none';
                        }
                        updateStepView();
                    }
                };
                
                const settings = appSettings;
                if (!settings || !settings.categorySettings) { categorySelect.innerHTML = `<option value="" disabled selected>No categories configured</option>`; return; }
                const categorySettings = settings.categorySettings || {};
                const availableCategories = Object.keys(categorySettings);
                if (availableCategories.length === 0) { categorySelect.innerHTML = `<option value="" disabled selected>No categories available</option>`; return; }
                
                categorySelect.innerHTML = `<option value="" disabled selected>Select a Category</option>` + availableCategories.map(catKey => `<option value="${catKey}">${getCategoryDisplayName(catKey)}</option>`).join('');
                
                document.getElementById('task-thumbnail-input').onchange = (evt) => {
                    const preview = document.getElementById('add-task-thumbnail-preview');
                    const [file] = evt.target.files;
                    if (file) {
                        preview.src = URL.createObjectURL(file);
                        preview.style.display = 'block';
                    }
                };
                
                const updateTotalCost = () => {
                    const selectedCategory = categorySelect.value;
                    if (!selectedCategory || !categorySettings[selectedCategory]) return;
                    const catSettings = categorySettings[selectedCategory], quantity = parseInt(form['task-quantity'].value) || 0, reward = parseFloat(form['task-reward'].value || 0), screenshots = parseInt(form['task-screenshots'].value) || 1;
                    if (reward < catSettings.workerReward) { 
                        form.querySelector('#total-cost').textContent = `Reward too low (min ৳${catSettings.workerReward.toFixed(2)})`; submitBtn.disabled = true; 
                    } else { submitBtn.disabled = false; }
                    const platformFee = catSettings.platformFee || 0, extraShotCost = screenshots > 1 ? (screenshots - 1) * (settings.extraScreenshotCost || 0) : 0;
                    form.querySelector('#total-cost').textContent = (quantity * (reward + platformFee + extraShotCost)).toFixed(2);
                    form.querySelector('#cost-summary-card').style.display = 'block';
                };

                const updateFieldsForCategory = () => {
                    const selectedCategory = categorySelect.value;
                    const catSettings = categorySettings[selectedCategory];
                    if (!catSettings) return;
                    form.querySelector('#task-reward-label').innerHTML = `Worker Reward (Minimum ৳${(catSettings.workerReward || 0).toFixed(2)}):`;
                    form.querySelector('#task-reward').value = (catSettings.workerReward || 0).toFixed(2);
                    form.querySelector('#task-reward').min = catSettings.workerReward || 0;
                    form.querySelector('#screenshots-label').innerHTML = `Screenshots Required (1 is free, each extra costs ৳${(settings.extraScreenshotCost || 0).toFixed(2)}):`;
                    updateTotalCost();
                };

                form.querySelectorAll('input[type="number"]').forEach(input => input.addEventListener('input', updateTotalCost));

                form.onsubmit = e => {
                     e.preventDefault();
                    if (!validateStep(3)) return;
                     Object.assign(taskData, {
                        category: form['task-category'].value,
                        title: form['task-title'].value,
                        description: form['task-description'].value,
                        requiredProof: form['task-required-proof'].value,
                        reward: parseFloat(form['task-reward'].value),
                        quantity: parseInt(form['task-quantity'].value),
                        screenshotsRequired: parseInt(form['task-screenshots'].value)
                    });
                    handleAddTaskSubmit(taskData, currentUserData, settings);
                };
            };

            const handleAddTaskSubmit = async (finalTaskData, currentUserData, settings) => { 
                showLoader(true);
                const { category, reward, quantity, screenshotsRequired } = finalTaskData;
                const catSettings = settings.categorySettings[category];
                if (reward < catSettings.workerReward) { alert(`Reward for this category cannot be less than ৳${catSettings.workerReward.toFixed(2)}`); showLoader(false); return; }
                const platformFee = catSettings.platformFee || 0, totalCost = quantity * (reward + platformFee + (screenshotsRequired > 1 ? (screenshotsRequired - 1) * (settings.extraScreenshotCost || 0) : 0));
                if (activeUserData.balance < totalCost) { alert('Insufficient balance.'); showLoader(false); return; }
                
                try {
                    const fullTaskData = {
                        ...finalTaskData,
                        creatorId: currentUserData.uid,
                        createdAt: serverTimestamp(),
                        completedCount: 0
                    };
                    const newJobRef = push(ref(database, 'tasks'));
                    await runTransaction(ref(database, `users/${currentUserData.uid}`), (user) => {
                        if (user) { user.balance = (user.balance || 0) - totalCost; user.jobsCreated = (user.jobsCreated || 0) + 1; }
                        return user;
                    });
                    await set(newJobRef, fullTaskData);
                    alert('Job created successfully!'); window.location.hash = '#my-jobs';
                } catch(err) { console.error(err); alert("Failed to create job."); } finally { showLoader(false); } 
            };
            
            // --- 'My Jobs' section as per user's 2nd file ---
            const renderMyJobsPage = (currentUserData) => {
                appContent.innerHTML = `<h3>My Jobs</h3><div class="card"><div class="tab-buttons"><button class="button active" data-tab="created-jobs">Created Jobs</button><button class="button" data-tab="completed-tasks">Completed Tasks</button></div><div id="my-jobs-content"></div></div>`;
                const contentEl = appContent.querySelector('#my-jobs-content'), tabs = appContent.querySelectorAll('.tab-buttons .button');
                const switchTab = (tabName) => { tabs.forEach(t => t.classList.toggle('active', t.dataset.tab === tabName)); if (tabName === 'created-jobs') renderCreatedJobs(currentUserData, contentEl); else renderCompletedTasks(currentUserData, contentEl); };
                tabs.forEach(t => t.onclick = () => switchTab(t.dataset.tab)); switchTab('created-jobs');
            };

            const renderCreatedJobs = (currentUserData, container) => {
                container.innerHTML = `<h4>My Created Jobs</h4><div id="created-jobs-list"><p>Loading jobs...</p></div>`;
                const listEl = container.querySelector('#created-jobs-list');
                const q = query(ref(database, 'tasks'), orderByChild('creatorId'), equalTo(currentUserData.uid));
                onValue(q, (snapshot) => {
                    listEl.innerHTML = !snapshot.exists() ? `<p>You haven't created any jobs yet.</p>` : ''; if(!snapshot.exists()) showLoader(false);
                    snapshot.forEach(child => {
                        const taskId = child.key, task = child.val();
                        listEl.innerHTML += `<div class="card" id="job-card-${taskId}"><h5>${task.title}</h5><p><strong>Progress:</strong> <span id="progress-${taskId}">${task.completedCount || 0}</span>/${task.quantity}</p><div class="submissions-container" id="submissions-for-${taskId}"></div><div class="increase-limit-form"><form class="increase-limit-form-inner" data-task-id="${taskId}" data-reward="${task.reward}" data-category="${task.category}" data-screenshots="${task.screenshotsRequired||1}"><input type="number" min="1" placeholder="Add Qty" required><button type="submit" class="button">Pay & Add</button></form><p id="increase-cost-${taskId}"></p></div></div>`;
                        const subQuery = query(ref(database, `task_submissions/${taskId}`), orderByChild('status'), equalTo('pending'));
                        onValue(subQuery, (subSnap) => {
                            const subsContainer = document.getElementById(`submissions-for-${taskId}`); if (!subsContainer) return;
                            subsContainer.innerHTML = '<h6>Pending Submissions:</h6>';
                            if (subSnap.exists()) {
                                subSnap.forEach(userSub => {
                                    const subData = userSub.val();
                                    subsContainer.innerHTML += `<div class="list-item"><span>${subData.submitterName}</span><div class="item-actions"><button class="button btn-view-proof" data-proofs='${JSON.stringify(subData)}'>View</button><button class="button btn-approve" data-task-id="${taskId}" data-submitter-id="${userSub.key}">Approve</button><button class="button btn-reject" data-task-id="${taskId}" data-submitter-id="${userSub.key}">Reject</button></div></div>`;
                                });
                            } else {
                                subsContainer.innerHTML += '<p>No pending submissions.</p>';
                            }
                        });
                    });
                    listEl.querySelectorAll('.increase-limit-form-inner').forEach(form => { form.onsubmit = handleIncreaseLimit; form.querySelector('input').oninput = e => calculateIncreaseCost(e); });
                    showLoader(false);
                }, { once: true });
            };

            const renderCompletedTasks = (currentUserData, container) => {
                container.innerHTML = `<h4>My Completed Tasks</h4><div id="completed-tasks-list"><p>Loading task history...</p></div>`;
                const listEl = container.querySelector('#completed-tasks-list');
                onValue(ref(database, `submissions/${currentUserData.uid}`), async (snapshot) => {
                    if (!snapshot.exists()) { listEl.innerHTML = '<p>You have not completed any tasks yet.</p>'; showLoader(false); return; }
                    const submissions = snapshot.val(), taskIds = Object.keys(submissions);
                    const taskPromises = taskIds.map(taskId => get(ref(database, `tasks/${taskId}`)));
                    const taskSnapshots = await Promise.all(taskPromises);
                    const tasksData = taskSnapshots.reduce((acc,snap)=>{ if(snap.exists())acc[snap.key]=snap.val();return acc; }, {});
                    let historyHTML = '';
                    taskIds.reverse().forEach(taskId => {
                        const submission=submissions[taskId], task=tasksData[taskId];
                        if (task) historyHTML += `<div class="list-item"><div><strong>${task.title}</strong><br><small>Reward: ৳${task.reward.toFixed(2)}</small></div><span class="status-badge status-${submission.status}">${submission.status}</span></div>`;
                    });
                    listEl.innerHTML = historyHTML || '<p>You have not completed any tasks yet.</p>'; showLoader(false);
                }, { once: true });
            };

            const handleIncreaseLimit = async (e) => {
                e.preventDefault(); const form = e.target, taskId = form.dataset.taskId, addQty = parseInt(form.querySelector('input').value); if (!addQty || addQty < 1) return; showLoader(true);
                try {
                    const settings = appSettings, category = form.dataset.category, catSettings = settings.categorySettings ? (settings.categorySettings[category] || {}) : {};
                    const platformFee = catSettings.platformFee || 0, extraScreenshotCost = settings.extraScreenshotCost || 0.01;
                    const extraShotCostTotal = ((parseInt(form.dataset.screenshots) || 1) - 1) * extraScreenshotCost;
                    const cost = (parseFloat(form.dataset.reward) + platformFee + extraShotCostTotal) * addQty;
                    await runTransaction(ref(database, `users/${currentUserId}`), (user) => {
                        if (user) { if ((user.balance || 0) < cost) return; user.balance -= cost; } return user;
                    });
                    await runTransaction(ref(database, `tasks/${taskId}/quantity`), (qty) => (qty || 0) + addQty);
                    alert('Limit increased!'); form.reset();
                } catch (err) { alert(`Error: ${err.message}`); } finally { showLoader(false); }
            };

            const calculateIncreaseCost = (e) => {
                const input = e.target, form = input.closest('form'), qty = parseInt(input.value) || 0;
                const costEl = document.getElementById(`increase-cost-${form.dataset.taskId}`); if (!qty || qty < 1) { costEl.textContent = ''; return; }
                const settings = appSettings, category = form.dataset.category, catSettings = settings.categorySettings ? (settings.categorySettings[category] || {}) : {};
                const platformFee = catSettings.platformFee || 0, extraScreenshotCost = settings.extraScreenshotCost || 0.01;
                const extraShotCostTotal = ((parseInt(form.dataset.screenshots) || 1) - 1) * extraScreenshotCost;
                const totalCost = qty * (parseFloat(form.dataset.reward) + platformFee + extraShotCostTotal);
                costEl.textContent = `Estimated Cost: ৳${totalCost.toFixed(2)}`;
            };
            
            // --- [UPDATED] Referral Bonus & Daily Salary Section with working logic ---
            const handleJobReview = async (e) => {
                const button = e.target.closest(".btn-approve, .btn-reject");
                if (!button) return;
                const { taskId, submitterId } = button.dataset;
                const action = button.classList.contains("btn-approve") ? "approved" : "rejected";
                showLoader(true);
                button.disabled = true;

                try {
                    let alertMessage = `Submission ${action}.`;

                    if (action === "approved") {
                        const taskReward = (await get(ref(database, `tasks/${taskId}`))).val().reward || 0;

                        await runTransaction(ref(database, `users/${submitterId}`), (user) => {
                            if (user) {
                                user.balance = (user.balance || 0) + taskReward;
                                user.totalIncome = (user.totalIncome || 0) + taskReward;
                                user.tasksCompleted = (user.tasksCompleted || 0) + 1;
                            }
                            return user;
                        });

                        await runTransaction(ref(database, `tasks/${taskId}/completedCount`), (count) => (count || 0) + 1);

                        const [submitterSnap, settingsSnap] = await Promise.all([
                            get(ref(database, `users/${submitterId}`)),
                            get(ref(database, "settings"))
                        ]);

                        if (submitterSnap.exists() && settingsSnap.exists()) {
                            const submitterData = submitterSnap.val();
                            const settings = settingsSnap.val();
                            const referralBonus = settings.referralBonus || 0;
                            const requiredJobs = settings.referralRequiredJobs || 0;

                            if (submitterData.referredBy && !submitterData.referralBonusAwarded && referralBonus > 0 && requiredJobs > 0 && submitterData.tasksCompleted >= requiredJobs) {
                                const referrerRef = ref(database, `users/${submitterData.referredBy}`);
                                await runTransaction(referrerRef, (referrer) => {
                                    if (referrer) {
                                        referrer.balance = (referrer.balance || 0) + referralBonus;
                                        referrer.referralIncome = (referrer.referralIncome || 0) + referralBonus;
                                    }
                                    return referrer;
                                });
                                await update(ref(database, `users/${submitterId}`), { referralBonusAwarded: true });
                                alertMessage += `\nReferral bonus of ৳${referralBonus} paid to referrer!`;
                            }
                        }
                    }

                    await update(ref(database), {
                        [`/task_submissions/${taskId}/${submitterId}/status`]: action,
                        [`/submissions/${submitterId}/${taskId}/status`]: action
                    });

                    alert(alertMessage);
                    button.closest(".list-item").remove();
                } catch (err) {
                    button.disabled = false;
                    alert(`An error occurred: ${err.message}`);
                    console.error("Approval/Rejection error:", err);
                } finally {
                    showLoader(false);
                }
            };
            
            const renderReferPage = (currentUserData) => {
                appContent.innerHTML = `<div class="card"><div class="tab-buttons"><button class="button active" data-tab="referral-bonus">Referral Bonus</button><button class="button" data-tab="daily-salary">Daily Salary</button></div><div id="refer-content"></div></div>`;
                const contentEl = appContent.querySelector('#refer-content');
                const tabs = appContent.querySelectorAll('.tab-buttons .button');
                
                const switchTab = (tabName) => {
                    tabs.forEach(t => t.classList.toggle('active', t.dataset.tab === tabName));
                    if (tabName === 'referral-bonus') {
                        renderReferralBonusContent(currentUserData, contentEl);
                    } else {
                        renderDailySalaryContent(currentUserData, contentEl);
                    }
                };
                
                tabs.forEach(t => t.onclick = () => switchTab(t.dataset.tab));
                switchTab('referral-bonus');
            };

            const renderReferralBonusContent = (currentUserData, container) => {
                const settings = appSettings;
                const referralBonus = settings.referralBonus || 10;
                const requiredJobs = settings.referralRequiredJobs || 10;
                const referralLink = `${window.location.origin}${window.location.pathname}?ref=${currentUserData.referralCode}`;
                const referralsQuery = query(ref(database, 'users'), orderByChild('referredBy'), equalTo(currentUserData.uid));
                
                get(referralsQuery).then(snapshot => {
                    let referralsCount = 0;
                    let referralListHTML = '';

                    if (snapshot.exists()) {
                        referralsCount = snapshot.size;
                        let referredUsers = [];
                        snapshot.forEach(childSnap => {
                            const user = childSnap.val();
                             if(user.isActive){
                                referredUsers.push(user);
                             }
                        });

                        referralListHTML = `<div class="card referral-status-list">
                                <h4>My Referrals Status</h4>
                                ${referredUsers.map(user => {
                                    const tasksDone = user.tasksCompleted || 0;
                                    const isComplete = tasksDone >= requiredJobs;
                                    return `<div class="referral-list-item">
                                        <span class="name">${user.name}</span>
                                        <span class="status ${isComplete ? 'complete' : ''}">
                                            ${isComplete ? 'Completed' : `Jobs: ${tasksDone}/${requiredJobs}`}
                                        </span>
                                    </div>`;
                                }).join('')}
                            </div>`;
                    } else {
                         referralListHTML = `<div class="card"><p style="text-align:center;">You haven't referred anyone yet.</p></div>`;
                    }
                    
                    const referralIncome = currentUserData.referralIncome || 0;

                    container.innerHTML = `
                        <div class="refer-hero-card">
                            <h3>Refer Friends & Earn!</h3>
                            <p>You will get a ৳${referralBonus} bonus for each referral after they complete ${requiredJobs} jobs.</p>
                            <div class="refer-bonus-display"><sup>৳</sup>${referralBonus}</div>
                            <div class="refer-code-box"><span>${currentUserData.referralCode}</span></div>
                        </div>
                        <div class="card">
                            <button class="button" onclick="window.copyToClipboard('${referralLink}')">Copy Referral Link</button>
                        </div>
                        ${referralListHTML}
                        <div class="card refer-stat-card"> <div class="icon"><svg viewBox="0 0 24 24"><path d="M16,13C17.66,13,19,11.66,19,10C19,8.34,17.66,7,16,7C14.34,7,13,8.34,13,10C13,11.66,14.34,13,16,13M8,13C9.66,13,11,11.66,11,10C11,8.34,9.66,7,8,7C6.34,7,5,8.34,5,10C5,11.66,6.34,13,8,13M8,15C5.67,15,1,16.17,1,18.5V21H15V18.5C15,16.17,10.33,15,8,15M16,15C15.71,15,15.38,15.02,15.03,15.05C16.19,15.89,17,17.12,17,18.5V21H23V18.5C23,16.17,18.33,15,16,15Z"></path></svg></div> <h4>Total Referrals</h4> <p>${referralsCount}</p> </div>
                        <div class="card refer-stat-card"> <div class="icon"><svg viewBox="0 0 24 24"><path d="M5,6H23V18H5V6M14,9A3,3 0 0,1 17,12A3,3 0 0,1 14,15A3,3 0 0,1 11,12A3,3 0 0,1 14,9M9,8A2,2 0 0,1 7,10V14A2,2 0 0,1 5,16H2V15A3,3 0 0,1 5,12A3,3 0 0,1 8,9H9M21,20H3V19A2,2 0 0,1 5,17H21A2,2 0 0,1 23,19V20H21Z" /></svg></div> <h4>Referral Income</h4> <p>৳${referralIncome.toFixed(2)}</p> </div>`;
                });
            };

            const renderDailySalaryContent = async (currentUserData, container) => {
                const settings = appSettings;
                const requiredReferrals = settings.salaryMinReferrals || 10;
                const workCommission = settings.salaryWorkCommission || 0.01;
                const submitCommission = settings.salarySubmitCommission || 0.01;

                const referralsQuery = query(ref(database, 'users'), orderByChild('referredBy'), equalTo(currentUserData.uid));
                const referralsSnap = await get(referralsQuery);
                
                let activeReferrals = 0;
                if (referralsSnap.exists()) {
                    referralsSnap.forEach(child => { if (child.val().isActive) { activeReferrals++; } });
                }

                const isEligible = activeReferrals >= requiredReferrals;
                let eligibilityHTML = isEligible 
                    ? `<div class="card alert-card alert-success"><h3>Congratulations!</h3><p>You are eligible for Daily Salary. You have ${activeReferrals} active referrals.</p></div>`
                    : `<div class="card alert-card alert-inactive"><h3>Not Eligible for Daily Salary</h3><p>You need at least <strong>${requiredReferrals}</strong> active referrals to be eligible. You currently have <strong>${activeReferrals}</strong>.</p></div>`;

                container.innerHTML = `
                    ${eligibilityHTML}
                    <div class="card">
                        <h4>How Daily Salary Works</h4>
                        <p style="font-style:italic; font-size: 0.9rem; margin-bottom: 1rem;">This is a manual claim system. You can claim your salary once every 24 hours.</p>
                        <button id="claim-salary-btn" class="button" ${isEligible ? "" : "disabled"}>Claim Daily Salary</button>
                        <small id="claim-timer" style="display:block; text-align:center; margin-top:0.5rem;"></small>
                    </div>
                    <div class="card">
                        <h4>Salary Rules</h4>
                        <ul style="padding-left: 1.5rem;">
                            <li><strong>৳${submitCommission.toFixed(3)}</strong> for every job your referrals post.</li>
                            <li><strong>৳${workCommission.toFixed(3)}</strong> for every task they complete.</li>
                        </ul>
                        <p style="margin-top: 1rem; font-size: 0.9rem; color: var(--grey-color);">Commissions are calculated from your last claim time.</p>
                    </div>
                    <div class="card">
                        <h4>Daily Salary History</h4>
                        <div id="daily-salary-log"><p>Loading history...</p></div>
                    </div>`;

                if (isEligible) {
                    const claimBtn = document.getElementById("claim-salary-btn");
                    const timerEl = document.getElementById("claim-timer");
                    claimBtn.onclick = () => handleSalaryClaim(currentUserData);

                    const lastClaim = currentUserData.lastSalaryClaim;
                    if (lastClaim) {
                        const twentyFourHours = 24 * 60 * 60 * 1000;
                        const timeSinceLastClaim = Date.now() - lastClaim;

                        if (timeSinceLastClaim < twentyFourHours) {
                            claimBtn.disabled = true;
                            const remainingTime = twentyFourHours - timeSinceLastClaim;
                            const seconds = Math.ceil(remainingTime / 1000);
                            const hours = Math.floor(seconds / 3600);
                            const minutes = Math.floor((seconds % 3600) / 60);
                            timerEl.textContent = `Next claim available in ${hours}h ${minutes}m`;
                        }
                    }
                }

                const salaryLogEl = container.querySelector('#daily-salary-log');
                const salaryHistoryRef = ref(database, `users/${currentUserData.uid}/dailySalaryHistory`);
                onValue(salaryHistoryRef, (snapshot) => {
                    if (snapshot.exists()) {
                        let logHTML = '';
                        let salaryData = [];
                        snapshot.forEach(child => {
                            salaryData.push(child.val());
                        });
                        salaryData.reverse();
                        
                        salaryData.forEach(entry => {
                            logHTML += `<div class="list-item">
                                <span>${new Date(entry.timestamp).toLocaleDateString("en-GB")}</span>
                                <strong>৳${entry.amount.toFixed(3)}</strong>
                            </div>`;
                        });
                        salaryLogEl.innerHTML = logHTML;
                    } else {
                        salaryLogEl.innerHTML = '<p>No salary history yet.</p>';
                    }
                }, { once: true });
            };

            const handleSalaryClaim = async (currentUserData) => {
                const claimBtn = document.getElementById('claim-salary-btn');
                claimBtn.disabled = true; claimBtn.textContent = 'Checking...';
                const lastClaim = currentUserData.lastSalaryClaim || 0;
                if (Date.now() - lastClaim < 864e5) { alert('You can only claim your salary once every 24 hours.'); claimBtn.disabled = false; claimBtn.textContent = 'Claim Daily Salary'; return; }

                showLoader(true); claimBtn.textContent = 'Calculating...';
                try {
                    const settings = appSettings;
                    const workCommission = settings.salaryWorkCommission || 0.01;
                    const submitCommission = settings.salarySubmitCommission || 0.01;
                    let totalCommission = 0;

                    const referralsSnap = await get(query(ref(database, 'users'), orderByChild('referredBy'), equalTo(currentUserData.uid)));
                    if (!referralsSnap.exists()) { throw new Error("You don't have any referrals."); }
                    
                    const referralPromises = [];
                    referralsSnap.forEach(child => {
                        const referral = { id: child.key, ...child.val() };
                        if(referral.isActive){
                            const submissionsQuery = query(ref(database, `submissions/${referral.id}`), orderByChild('timestamp'), startAt(lastClaim));
                            referralPromises.push(get(submissionsQuery).then(snap => {
                                let completedTasks = 0;
                                snap.forEach(subSnap => { if(subSnap.val().status === 'approved') completedTasks++; });
                                totalCommission += completedTasks * workCommission;
                            }));

                            const tasksQuery = query(ref(database, 'tasks'), orderByChild('creatorId'), equalTo(referral.id));
                             referralPromises.push(get(tasksQuery).then(snap => {
                                snap.forEach(taskSnap => {
                                    if(taskSnap.val().createdAt > lastClaim) {
                                         totalCommission += submitCommission;
                                    }
                                });
                            }));
                        }
                    });
                    await Promise.all(referralPromises);

                    const now = serverTimestamp();
                    if(totalCommission > 0){
                        await runTransaction(ref(database, `users/${currentUserId}`), (user) => {
                            if (user) {
                                user.balance = (user.balance || 0) + totalCommission;
                                user.referralIncome = (user.referralIncome || 0) + totalCommission;
                                user.lastSalaryClaim = now;
                            }
                            return user;
                        });
                        await push(ref(database, `users/${currentUserId}/dailySalaryHistory`), { amount: totalCommission, timestamp: now });
                        alert(`Congratulations! ৳${totalCommission.toFixed(3)} has been added to your balance.`);
                    } else {
                        await update(ref(database, `users/${currentUserId}`), { lastSalaryClaim: now });
                        alert("No new earnings from your referrals to claim at this moment.");
                    }
                } catch(err){ alert("An error occurred during calculation: " + err.message); } 
                finally { showLoader(false); claimBtn.textContent = 'Claim Daily Salary'; }
            };

            // --- 'Wallet' section as per user's 2nd file ---
            const renderWalletPage = (currentUserData) => { 
                const formatDate = (ts) => ts ? new Date(ts).toLocaleDateString('en-GB') : 'N/A';
                appContent.innerHTML = `<div class="card"><h3>Wallet</h3><div class="tab-buttons"><button class="button active" data-tab="deposit">Deposit</button><button class="button" data-tab="withdraw">Withdrawal</button></div><div id="wallet-content"></div></div>`;
                const walletContent = appContent.querySelector('#wallet-content'), tabs = appContent.querySelectorAll('.tab-buttons .button');
                const switchTab = (tabName) => { tabs.forEach(t=>t.classList.remove('active')); appContent.querySelector(`[data-tab=${tabName}]`).classList.add('active'); walletContent.innerHTML='<p>Loading...</p>';
                    const settings = appSettings;
                    if(tabName==='deposit'){
                        const minDeposit=settings.minDeposit||25, depositNumber=settings.depositNumber||"N/A";
                        walletContent.innerHTML=`<h4>Deposit Funds</h4><p>Minimum: ৳${minDeposit}</p><div class="payment-info"><span>${depositNumber} (${settings.depositMethod||''})</span><button class="copy-btn" onclick="copyToClipboard('${depositNumber}')">Copy</button></div><form id="deposit-form" style="margin-top:1rem;"><label>Amount:</label><input type="number" id="deposit-amount" min="${minDeposit}" required><label>TrxID:</label><input type="text" id="deposit-trxid" required><button type="submit">Request</button></form><hr style="margin:2rem 0 1rem;"><h5 >History</h5><div id="deposits-history"></div>`;
                        walletContent.querySelector('#deposit-form').onsubmit = e=>{e.preventDefault();showLoader(true);const amount=parseFloat(e.target['deposit-amount'].value),trxId=e.target['deposit-trxid'].value.trim(); try{push(ref(database,'deposits'),{userId:currentUserData.uid,userName:currentUserData.name,amount,trxId,status:'pending',timestamp:serverTimestamp()});alert('Request submitted!');e.target.reset();}catch(err){alert(`Error: ${err.message}`);}finally{showLoader(false);}};
                        onValue(query(ref(database,'deposits'),orderByChild('userId'),equalTo(currentUserData.uid)),s=>{const el=document.getElementById('deposits-history');if(!el)return;el.innerHTML='';let hasItems=false;s.forEach(c=>{hasItems=true;const item=c.val();el.innerHTML=`<div class="list-item"><div><strong>৳${item.amount}</strong><br><small>${formatDate(item.timestamp)}</small></div><span class="status-badge status-${item.status}">${item.status}</span></div>`+el.innerHTML});if(!hasItems)el.innerHTML='<p>No history.</p>';},{once:true});
                    } else if (tabName==='withdraw'){
                        const minWithdraw=settings.minWithdraw||50, feePercent=settings.withdrawalFeePercent||0;
                        walletContent.innerHTML=`<h4>Withdraw Funds</h4><p>Minimum: ৳${minWithdraw} | Fee: ${feePercent}%</p><form id="withdraw-form"><label>Amount (Balance: ৳${(activeUserData.balance||0).toFixed(2)}):</label><input type="number" id="withdraw-amount" min="${minWithdraw}" max="${activeUserData.balance||0}" required><div id="withdraw-summary" style="margin-bottom:1rem;"></div><label>Method:</label><select id="withdraw-method">${(settings.paymentMethods||['Bkash','Nagad']).map(m=>`<option value="${m}">${m}</option>`).join('')}</select><label>Account Number:</label><input type="text" id="withdraw-number" required><button type="submit">Request</button></form><hr style="margin:2rem 0 1rem;"><h5 >History</h5><div id="withdraws-history"></div>`;
                        const amountInput=walletContent.querySelector('#withdraw-amount'),summaryEl=walletContent.querySelector('#withdraw-summary');
                        amountInput.addEventListener('input',()=>{const amount=parseFloat(amountInput.value)||0;if(amount>=minWithdraw){const fee=(amount*feePercent)/100;summaryEl.innerHTML=`<p style="background:#eee;padding:10px;border-radius:8px;font-size:0.9rem;">Fee: ৳${fee.toFixed(2)}<br>You will receive: <b>৳${(amount-fee).toFixed(2)}</b></p>`;}else{summaryEl.innerHTML='';}});
                        walletContent.querySelector('#withdraw-form').onsubmit = async e => {
                            e.preventDefault();showLoader(true);
                            const amount = parseFloat(e.target['withdraw-amount'].value);
                            try {
                                await runTransaction(ref(database, `users/${currentUserId}`), (user) => {
                                    if (user) { if ((user.balance || 0) < amount) { throw("Insufficient balance."); } user.balance -= amount; } return user;
                                });
                                await push(ref(database,'withdraws'), { userId: currentUserId, userName: activeUserData.name, amount, status: 'pending', method: e.target['withdraw-method'].value, number: e.target['withdraw-number'].value, timestamp: serverTimestamp() });
                                alert('Request submitted successfully!');
                                e.target.reset();
                                summaryEl.innerHTML = '';
                            } catch(err) { alert(`An error occurred: ${err}`); } finally { showLoader(false); }
                        };
                        onValue(query(ref(database,'withdraws'),orderByChild('userId'),equalTo(currentUserData.uid)),s=>{const el=document.getElementById('withdraws-history');if(!el)return;el.innerHTML='';let hasItems=false;s.forEach(c=>{hasItems=true;const item=c.val();el.innerHTML=`<div class="list-item"><div><strong>৳${item.amount}</strong><br><small>${formatDate(item.timestamp)}</small></div><span class="status-badge status-${item.status}">${item.status}</span></div>`+el.innerHTML});if(!hasItems)el.innerHTML='<p>No history.</p>';},{once:true});
                    }
                };
                tabs.forEach(t=>t.onclick=()=>switchTab(t.dataset.tab)); switchTab('deposit');
            };
            
            const routes = { home: renderHomePage, tasks: renderTasksListPage, 'add-task': renderAddTaskPage, 'my-jobs': renderMyJobsPage, refer: renderReferPage, wallet: renderWalletPage };
            appContent.addEventListener('click', e => { if (e.target.closest('.btn-approve, .btn-reject')) { handleJobReview(e); } else if (e.target.closest('.btn-view-proof')) { const data = JSON.parse(e.target.closest('.btn-view-proof').dataset.proofs); proofModalBody.innerHTML = ''; if (data.textProof) proofModalBody.innerHTML += `<p><strong>Text Proof:</strong> ${data.textProof}</p>`; if (data.proofImages) data.proofImages.forEach(url => { proofModalBody.innerHTML += `<a href="${url}" target="_blank"><img src="${url}" alt="proof" loading="lazy"></a>`; }); proofModal.style.display = 'flex'; }});
            window.addEventListener('hashchange', () => handleRouting(activeUserData));
            navItems.forEach(item => item.addEventListener('click', (e) => { e.preventDefault(); window.location.hash = item.dataset.page; }));
        }
    </script>
</body>
</html>